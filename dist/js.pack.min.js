var SIM,$jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var b="";a;)if(a&1&&(b+=c),a>>>=1)c+=c;return b}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var f in e)$jscomp.owns(e,f)&&(a[f]=e[f])}return a}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
$jscomp.polyfill("Math.hypot",function(a){return a?a:function(a,c,d){a=Number(a);c=Number(c);var b,f=Math.max(Math.abs(a),Math.abs(c));for(b=2;b<arguments.length;b++)f=Math.max(f,Math.abs(arguments[b]));if(1E100<f||1E-100>f){a/=f;c/=f;var g=a*a+c*c;for(b=2;b<arguments.length;b++){var k=Number(arguments[b])/f;g+=k*k}return Math.sqrt(g)*f}g=a*a+c*c;for(b=2;b<arguments.length;b++)k=Number(arguments[b]),g+=k*k;return Math.sqrt(g)}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");var VERSION="0.3/arcticio/04-July-2017";"use strict";
try{(function(){var a=window.CanvasRenderingContext2D;var b=document.createElement("canvas");b=b.getContext("webgl")||b.getContext("experimental-webgl");var c=!!window.Worker,d=b.getExtension("OES_texture_float"),e=b.getExtension("OES_texture_float_linear");try{window.postMessage("","*",[(new Float32Array(4)).buffer]);var f=!0}catch(g){f=!1}b.getExtension("WEBGL_lose_context").loseContext();if(!(a&&b&&d&&e&&c&&f))throw"FAILURE";})()}catch(a){console.error("APP NOT SUPPORTED",a)}"use strict";
function $I(){var a,b;if(!arguments[0]&&arguments[1])return document.createTextNode(arguments[1]);var c=document.createElement(arguments[0]);for(a=1;a<arguments.length;a++){var d=arguments[a];switch(typeof d){case "string":c.appendChild(document.createTextNode(d));break;case "object":if(d.nodeType)c.appendChild(d);else for(b in d)c[b]=d[b]}}return c}
var H=function(){var a={},b=Array.prototype.slice;a.extend||(a.extend=function(a){Array.prototype.slice.call(arguments,1).forEach(function(c){return Object.keys(c).forEach(function(b){a[b]=c[b]})});return a});a.extend(a,{interprete:function(a){return"function"===typeof a?a():a},eat:function(a){a.stopPropagation();return!1},isoToday:function(){var c=new Date;return[c.getUTCFullYear(),a.padZero(c.getUTCMonth()+1),a.padZero(c.getUTCDate())].join("-")},isoNow:function(){var c=new Date;return[c.getUTCFullYear(),
a.padZero(c.getUTCMonth()+1),a.padZero(c.getUTCDate())].join("-")+" "+[a.padZero(c.getUTCHours()),a.padZero(c.getUTCMinutes()),a.padZero(c.getUTCSeconds())].join(":")},iso2Day:function(a){a=a.split("-");return new Date(Date.UTC(a[0],a[1]-1,a[2]))},iso2DayHour:function(a){a=a.split("-");return new Date(Date.UTC(a[0],a[1]-1,a[2]||0,a[3]||0))},date2doe:function(a){return~~(a/864E5)},date2doeFloat:function(a){return a/864E5},iso2doe:function(a){a=a.split("-");return~~(new Date(Date.UTC(a[0],a[1]-1,a[2]))/
864E5)},range:function(a,b,e){var c=[];var d=arguments.length;if(0===d)return c;1===d&&(b=a,a=0,e=1);2===d&&(e=1);for(d=a;d<b;d+=e)c.push(d);return c},linspace:function(a,b,e){void 0===e&&(e=Math.max(Math.round(b-a)+1,1));if(2>e)return 1===e?[a]:[];var c,d=Array(e);e--;for(c=e;0<=c;c--)d[c]=(c*b+(e-c)*a)/e;return d},zip:function(){var c=a.toArray(arguments),b=c.slice(-1)[0],e=c.slice(1,-1),f=[];c[0].forEach(function(a,c){a=[a].concat(e.map(function(a){return a[c]}));f[c]=b.apply(b,a)});return f},
bounds:function(a,b,e){return Math.min(Math.max(a,b),e)},scale:function(a,b,e,f,g){return(g-f)*(a-b)/(e-b)+f},clamp:function(a,b,e){return a<b?b:a>e?e:a},isInteger:function(a){return Math.floor(a)===a},round:function(a,b){b=Math.pow(10,b);return Math.round(a*b)/b},format:function(){var a=0,d=b.call(arguments),e=d.slice(1);return(d[0]||"").split("%s").map(function(c){return c+(e[a++]||"")}).join("")},createAttenuator:function(a){var c=NaN;return function(b){return void 0===b?c:c=(isNaN(c)?b:c)*(a-
1)/a+1*b/a}},replace:function(c,b,e){return c.replace(new RegExp(a.escapeRex(b),"g"),e)},padZero:function(a,b){a="0000"+a;return a.substr(a.length-2,2)},mulString:function(a,b){return Array(b+1).join(a)},escapeRex:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},letterRange:function(c){return a.range(c.charCodeAt(0),c.charCodeAt(1)+1).map(function(a){return String.fromCharCode(a)}).join("")},findAll:function(a,b){var c=[],d;for(d=0;-1<(d=a.indexOf(b,d));)c.push(d),d+=1;
return c},tab:function(a,b){b=b||8;a=Array(b+1).join(" ")+a;return a.substr(a.length-b)},replaceAll:function(c,b,e){return e.replace(new RegExp(a.escapeRex(c),"g"),b)},endsWith:function(a,b){var c=a.length;return a.slice(c-b.length,c)===b},each:function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])},clone:function(a){var b,c={};for(b in a)c[b]=a[b];return c},firstAttr:function(a){for(var b in a)if(a.hasOwnProperty(b))return b},countAttrs:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&
(c+=1);return c},deepcopy:function(a){return JSON.parse(JSON.stringify(a))},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},prettify:function(a){return JSON.stringify(a).split('"').join("")},map:function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]="function"===typeof b?b(c,a[c]):b);return d},empty:function(a){a.splice(0,a.length)},last:function(a){return a[a.length-1]},delete:function(a,b){for(var c=0,d=0;void 0!==a[c];)b(a[c])?(a.splice(c,1),d++):c++;return d},
toArray:function(a){return Array.prototype.slice.call(a)},contains:function(a,b){return-1!==a.indexOf(b)},consume:function(a,b){for(;a.length;)b(a.shift())},toFixed:function(a,b){return a.map(function(a){return a.toFixed(1)})},rotate:function(a,b){return a.concat(a.splice(0,b))},sample:function(b,d){var c=b.length;return a.range(d||1).map(function(){return b[~~(Math.random()*c)]})},removeAll:function(a,b){var c,d;var g=c=0;for(d=a.length;c<d;c++)a[c]!==b&&(a[g++]=a[c]);a.length=g},remove:function(a,
b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},flatten:function(a){return a.reduce(function(a,b){return a.concat(b)})},pushUnique:function(a,b){-1===a.indexOf(b)&&a.push(b);return a},equal:function(a,b){return JSON.stringify(a)===JSON.stringify(b)},mean:function(a){return a.reduce(function(a,b){return a+b},0)/a.length},median:function(a){var b=a.length,c=~~(a.sort().length/2);return b?b%2?a[c]:(a[c-1]+a[c])/2:null},repeat:function(a,b){var c=[],d,g,k=a.length;for(d=0;d<b;d++)for(c.push([]),g=0;g<k;g++)c[d].push(a[g]);
return c},mode:function(a){var b,c={},f=[],g=0;for(b in a){var k=a[b];c[k]=void 0===c[k]?0:c[k]+1;c[k]===g?f.push(k):c[k]>g&&(g=c[k],f=[k])}return f},intersect:function(a,b){var c=0,d=0,g=a.length,k=b.length,l=[];a=a.sort();for(b=b.sort();c<g&&d<k;)a[c]<b[d]?c++:(a[c]>b[d]||(l.push(a[c]),c++),d++);return l},binda:function(a,b,e){var c=e.length;return 0===c?a.bind(b):1===c?a.bind(b,e[0]):2===c?a.bind(b,e[0],e[1]):3===c?a.bind(b,e[0],e[1],e[2]):4===c?a.bind(b,e[0],e[1],e[2],e[3]):void 0}});a.base64toBlob=
function(a,b,e){b=b||"";e=e||512;var c,d=atob(a),k=[];for(c=0;c<d.length;c+=e){var l=d.slice(c,c+e);var m=Array(l.length);for(a=0;a<l.length;a++)m[a]=l.charCodeAt(a);k.push(new Uint8Array(m))}return new Blob(k,{type:b})};a.humanFileSize=function(a,b){var c=b?1E3:1024;if(a<c)return a+" B";b=b?"kB MB GB TB PB EB ZB YB".split(" "):"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" ");var d=-1;do a/=c,++d;while(a>=c);return a.toFixed(1)+" "+b[d]};a.interpolate=function(a,b){var c=[],d=(a.length-1)/(b-1),g;c[0]=
a[0];for(g=1;g<b-1;g++){var k=g*d;var l=~~k;var m=a[l];c[g]=m+(a[l+1]-m)*(k-l)}c[b-1]=a[a.length-1];return c};a.createRingBuffer=function(b){var c=0,e=0,f=[];return{push:function(a){f[c]=a;e=c;c=(b+c+1)%b},buf:f,get:function(a){return f[a]},last:function(){return f[e]},max:function(){return Math.max.apply(Math,f)},min:function(){return Math.min.apply(Math,f)},sum:function(){return f.reduce(function(a,b){return a+b},0)},avg:function(){return f.reduce(function(a,b){return a+b},0)/b},trend:function(){return a.trend(f)}}};
a.trend=function(a){var b,c=a.length,f=0,g=0,k=0,l=0,m=0;for(b=0;b<c;b++){var h=b;var q=a[b];m+=1;f+=h;k+=h*h;g+=q;l+=h*q}return(m*l-f*g)/(m*k-f*f)};a.regress=function(a){var b,c=0,f=0,g=0,k=0,l=0;for(b=0;b<a.length;b++){var m=a[b][0];var h=a[b][1];var q=a[b][2]||1;l+=q;c+=q*m;g+=q*m*m;f+=q*h;k+=q*m*h}return[(l*k-c*f)/(l*g-c*c),(f*g-c*k)/(l*g-c*c)]};a.shuffle=function(a){var b,c,f;b;c;for(f=a.length;f;b=Math.floor(Math.random()*f),c=a[--f],a[f]=a[b],a[b]=c);return a};a.sayswho=function(){var a=navigator.appName,
b=navigator.userAgent,e,f=b.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);f&&null!=(e=b.match(/version\/([\.\d]+)/i))&&(f[2]=e[1]);return f?[f[1],f[2]]:[a,navigator.appVersion,"-?"]}();a.Base62={_Rixits:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",fromNumber:function(a){if(isNaN(Number(a))||null===a||a===Number.POSITIVE_INFINITY)throw"The input is not valid";if(0>a)throw"Can't represent negative numbers now";for(var b=Math.floor(a),c="";a=b%62,c=this._Rixits.charAt(a)+
c,b=Math.floor(b/62),0!=b;);return c},toNumber:function(a){var b,c=0;a=a.split("");for(b in a)a.hasOwnProperty(b)&&(c=62*c+this._Rixits.indexOf(a[b]));return c}};return a}();"use strict";
var TOOLS={debounce:function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c);c=setTimeout(function(){a.apply(d,e)},b)}},createLatLonsRectFibanocci:function(a){var b=Math.random()*a,c=[],d=2/a,e=Math.PI*(3-Math.sqrt(5));H.each(H.range(a),function(f,g){f=g*d-1+d/2;var k=Math.sqrt(1-Math.pow(f,2));g=(g+b)%a*e;x=Math.cos(g)*k;z=Math.sin(g)*k;c.push((new THREE.Vector3).fromArray([x,f,z]))});return c.map(function(a){return TOOLS.vector3ToLatLong(a,1)}).map(function(a){return[a.lat,
a.lon]})},createLatLonsSectorRandom:function(a,b){var c,d=[];for(c=0;c<b;c++)d.push([a[0]+Math.random()*(a[2]-a[0]),a[1]+Math.random()*(a[3]-a[1])]);return d},createLatLonsRectRandom:function(a,b,c){var d,e=[];for(d=0;d<c;d++){var f=a[1]+Math.random()*(b[1]-a[1]);var g=a[0]+Math.random()*(b[0]-a[0]);e.push([g,f])}return e},createLatLonsRect:function(a,b,c){c=c||1;var d=(b[1]-a[1]+1)/c,e=(b[0]-a[0]+1)/c;c=H.linspace(a[1],b[1],d);c=TOOLS.flatten(H.repeat(c,e));a=H.linspace(a[0],b[0],e);d=TOOLS.flatten(TOOLS.transpose(H.repeat(a,
d)));return H.zip(d,c,function(a,b){return[a,b]})},transpose:function(a){return a[0].map(function(b,c){return a.map(function(a){return a[c]})})},flatten:function(a,b){var c=[];b=b&&a||a.slice();if(!a.length)return c;a=b.pop();do Array.isArray(a)?b.push.apply(b,a):c.push(a);while(b.length&&void 0!==(a=b.pop()));c.reverse();return c},placeMarker:function(a,b){var c=TOOLS.latLongToVector3(b.latitude,b.longitude,b.radius,b.height);b=TOOLS.createMarker(b.size,b.color,c);a.add(b)},createMarker:function(a,
b,c){a=new THREE.SphereGeometry(a);b=new THREE.MeshLambertMaterial({color:b});b=new THREE.Mesh(a,b);b.position.copy(c);return b},vector3toScreenXY:function(a,b,c){a=(new THREE.Vector3(a.x,a.y,a.z)).project(SCN.camera);a.x=(a.x+1)/2*b;a.y=-(a.y-1)/2*c;return a},vector3ToLatLong:function(a,b){return{lat:90-180*Math.acos(a.y/b)/Math.PI,lon:(270+180*Math.atan2(a.x,a.z)/Math.PI)%360}},vector3ToLatLongMem:function(a,b,c,d){},latLongToVector3:function(a,b,c,d){a=a*Math.PI/180;b=(b-180)*Math.PI/180;return new THREE.Vector3(-(c+
d)*Math.cos(a)*Math.cos(b),(c+d)*Math.sin(a),(c+d)*Math.cos(a)*Math.sin(b))},placeMarkerAtAddress:function(a,b,c){b=b.replace(/\s/g,"+");var d=new XMLHttpRequest;d.open("GET","https://maps.googleapis.com/maps/api/geocode/json?address="+b);d.send(null);d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var b=JSON.parse(d.responseText);if(0<b.results.length){var f=b.results[0].geometry.location.lat;b=b.results[0].geometry.location.lng;Tools.placeMarker(a.getObjectByName("surface"),{latitude:f,
longitude:b,radius:.5,height:0,size:.01,color:c})}}}}};"use strict";function utc(a){return new UTC(a)}function UTC(){var a=Array.prototype.slice.call(arguments,0);this.date=1===a.length&&"string"===typeof a[0]?this.fromIso(a[0]).toDate():1===a.length&&"number"===typeof a[0]?new Date(a[0]):1===a.length&&"object"===typeof a[0]&&a[0].getTime?a[0]:1===a.length&&a[0]instanceof Array?new Date((new UTC).fromArray(a[0]).time()):1===a.length&&a[0]instanceof UTC?new Date(a[0].time()):new Date}
UTC.prototype={levels:"decade year month day hour min sec".split(" "),monthShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthLong:"January February March April May June July August September October November December".split(" "),weekdayShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),weekdayLong:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),year:function(){return this.date.getUTCFullYear()},month:function(){return this.date.getUTCMonth()},day:function(){return this.date.getUTCDate()},
hour:function(){return this.date.getUTCHours()},mins:function(){return this.date.getUTCMinutes()},secs:function(){return this.date.getUTCSeconds()},msecs:function(){return this.date.getUTCMilliseconds()},time:function(){return this.date.getTime()},toString:function(){return this.date.toJSON().toString()},toDate:function(){return this.date},toIso:function(a){return this.toArray().map(function(a){return 2>(a+"").length?H.padZero(a):a+""}).slice(0,a||3).join("-")},toArray:function(){return[this.date.getUTCFullYear(),
this.date.getUTCMonth()+1,this.date.getUTCDate(),this.date.getUTCHours(),this.date.getUTCMinutes(),this.date.getUTCSeconds(),this.date.getUTCMilliseconds()]},fromArray:function(a){var b=new Date(0);0<a.length&&b.setUTCFullYear(a[0]);1<a.length&&b.setUTCMonth(a[1]-1);2<a.length&&b.setUTCDate(a[2]);3<a.length&&b.setUTCHours(a[3]);4<a.length&&b.setUTCMinutes(a[4]);5<a.length&&b.setUTCSeconds(a[5]);6<a.length&&b.setUTCMilliseconds(a[6]);return new UTC(b)},setZone:function(){this.date.setUTCMinutes(this.date.getUTCMinutes()-
this.date.getTimezoneOffset());return this},align:function(a,b){var c=this.toArray();switch(a){case "hours":return c[3]=c[3]%24-c[3]%b,(new UTC).fromArray(c)}},delta:function(a,b){var c=this.date.getTime(),d=this.toArray();switch(a||"days"){case "years":return d[0]+=b,(new UTC).fromArray(d);case "months":return d[1]+=b,(new UTC).fromArray(d);case "days":return d[2]+=b,(new UTC).fromArray(d);case "hours":return utc(new Date(c+36E5*b));case "mins":return utc(new Date(c+6E4*b));case "secs":return utc(new Date(c+
1E3*b));case "msecs":return utc(new Date(c+b));default:throw Error("Not defined in utc.delta: "+a);}},neighbours:function(a,b,c){var d,e=[];c=c||1;for(d=-b;d<b+1;d++)e.push(utc(this.date).delta(a,d*c));return e},fromIso:function(a,b){a=a.split("-");var c=b=0,d=0,e=0,f=0,g=0,k=1;0<a.length&&(b=parseInt(a[0],10));1<a.length&&(c=parseInt(a[1],10)-1);2<a.length&&(k=parseInt(a[2],10));3<a.length&&(d=parseInt(a[3],10));4<a.length&&(e=parseInt(a[4],10));5<a.length&&(f=parseInt(a[5],10));6<a.length&&(g=parseInt(a[6],
10));a=new Date(b,c,k,d,e,f,g);a.setUTCMinutes(a.getUTCMinutes()-a.getTimezoneOffset());return new UTC(a)},centerIn:function(a){var b=this.lowerIn(a).time();a=this.upperIn(a).time();return new UTC(new Date(b+(a-b)/2+1))},lowerIn:function(a){var b=this.date,c;"year"===a?c=new Date(b.getUTCFullYear(),0,1,0,0,0,0):"month"===a?c=new Date(b.getUTCFullYear(),b.getUTCMonth(),1,0,0,0,0):"day"===a?c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),0,0,0,0):"hour"===a?c=new Date(b.getUTCFullYear(),
b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),0,0,0):"min"===a?c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),0,0):"sec"===a&&(c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),0));return(new UTC(c)).setZone()},upperIn:function(a){var b=this.date,c;"year"===a?c=new Date(b.getUTCFullYear()+1,0,0,23,59,59,999):"month"===a?c=new Date(b.getUTCFullYear(),b.getUTCMonth()+1,0,23,59,59,999):"day"===
a?c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),23,59,59,999):"hour"===a?c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),59,59,999):"min"===a?c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),59,999):"sec"===a&&(c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),999));return(new UTC(c)).setZone()},format:function(a){var b=this.date;b={a:this.weekdayShort[b.getDay()],
b:this.monthShort[b.getMonth()],Y:b.getUTCFullYear(),m:H.padZero(b.getUTCMonth()+1),d:H.padZero(b.getUTCDate()),e:b.getUTCDate(),M:H.padZero(b.getUTCMinutes()),H:H.padZero(b.getUTCHours())};for(t in b)b.hasOwnProperty(t)&&(a=a.split("%"+t).join(b[t]));return a}};function TimeRange(){this.ranges=[];this.className="TimeRange";this.push(Array.prototype.slice.call(arguments,0))}
TimeRange.prototype={levels:"decade year month day hour min sec".split(" "),log:function(a){this.ranges.forEach(function(a){})},length:function(){return this.ranges.length},toString:function(a){var b="";a=a||" <> ";this.ranges.forEach(function(c){b+="["+c[0]+a+c[1]+"], "});return b?b.substr(0,b.length-2):""},latest:function(){var a="";this.ranges.forEach(function(b){b[1]>a&&(a=b[1])});return""===a?null:a},extend:function(a){var b,c,d={year:1,month:2,day:3,hour:4}[a],e=new TimeRange;this.ranges.forEach(function(f){b=
utc(f[0]).lowerIn(a).toIso(d);c=utc(f[1]).upperIn(a).toIso(d);e.push(b,c)});return e},resolution:function(){var a=0;this.ranges.forEach(function(b){b[0].split("-").length>a&&(a=b[0].split("-").length)});return a},push:function(){var a=this,b=Array.prototype.slice.call(arguments,0);2===b.length&&"string"===typeof b[0]&&"string"===typeof b[1]?this.ranges.push([b[0],b[1]]):1===b.length&&b[0]instanceof Array&&b[0].length?this.ranges.push(b[0]):1===b.length&&b[0].className&&"TimeRange"===b[0].className&&
b[0].ranges.forEach(function(b){a.ranges.push(b)});return this},_upper:function(a,b){var c=a.split("-").length,d="year month day hour min sec msec".split(" ");return c<b?this._upper(utc(a).upperIn(d[c-1]).toIso(c+1),b):a},_lower:function(a,b){var c=a.split("-").length,d=["year","month","day","hour","min"];return c<b?this._lower(utc(a).lowerIn(d[c-1]).toIso(c+1),b):a},covers:function(a){var b=this;return this.ranges.some(function(c){var d=utc(c[0]).lowerIn(b.levels[c[0].split("-").length]).toIso(7);
c=utc(c[1]).upperIn(b.levels[c[1].split("-").length]).toIso(7);return(new TimeRange(d,c)).contains("milli",a)})},contains:function(a,b){var c=this,d=utc(b).time(),e=utc(b).centerIn(a).toDate(),f={year:1,month:2,day:3,hour:4}[a];switch(a){case "year":case "month":case "day":case "hour":case "min":case "sec":result=this.ranges.some(function(b){var d=utc(c._lower(b[0],f)).lowerIn(a).toIso(7);b=utc(c._upper(b[1],f)).upperIn(a).toIso(7);return(new TimeRange(d,b)).contains("milli",e)});break;case "milli":result=
this.ranges.some(function(a){var b=utc(a[0]).time();a=utc(a[1]).time();return d>=b&&d<=a})}return result}};
var RES=function(){function a(a,b){void 0!==a&&void 0!==b&&(f[a]+=Number(b));e.innerHTML="Req: "+f.requests+" Per: "+f.percent;e.style.backgroundSize=~~f.percent+"%"}var b,c=[],d=0;var e=document.querySelectorAll.bind(document)(".panel.info")[0];var f={queue:0,requests:0,bytesLoaded:0,bytesTotal:0,jobsTotal:0,percent:0};return b={onload:null,init:function(){},activate:function(a){e.innerHTML="R: 0, ETA: 0"},check:function(){var b=[];b=c.filter(function(a){return a.failed||a.finished});b.forEach(function(a){return H.remove(c,
a)});b=c.filter(function(a){return!a.active&&a.ready&&!a.failed}).slice(0,2);b.forEach(function(a){"texture"===a.options.type?a.loadtexture():a.execute()});f.queue=c.length;a()},add:function(a){d+=1;a.id=d;a=new b.Job(a);c.push(a);a.prepare();f.jobsTotal+=1;b.check()},load:function(a){var c=a.urls.map(function(c){return function(d){b.add({url:c,type:a.type||"",onFinish:function(a,b){a?d(a,null):d(null,b)}})}});async.parallel(c,a.onFinish)},Job:function(c){var d=this,e,g,h=c.url,q=c.type||"text",n=
0,p=0;this.options=c;this.id=c.id;this.active=this.ready=this.failed=this.finished=!1;var r=function(a){d.failed=!0;--f.requests;c.onFinish(a,null);setTimeout(b.check,20)},u=function(k){d.finished=!0;--f.requests;f.bytesTotal-=p;a("bytesLoaded",-p);c.onFinish(null,{data:k,mime:e,length:g,url:h});setTimeout(b.check,20)};this.prepare=function(){var c=new XMLHttpRequest;c.open("HEAD",h,!0);c.responseType="";c.onload=function(f){4===c.readyState&&(200===c.status?(e=c.getResponseHeader("Content-Type"),
g=c.getResponseHeader("Content-Length"),modified=c.getResponseHeader("Last-Modified"),n=Number(g),a("bytesTotal",n),d.ready=!0,b.check()):r(c.status+" "+c.statusText))};c.onerror=function(a){r(c.status+" "+c.statusText)};c.send(null)};this.loadtexture=function(){var b=new THREE.TextureLoader;d.active=!0;f.requests+=1;b.load(h,function(a){u(a)},function(b){b=b.loaded-p;p+=b;a("bytesLoaded",b)},function(a){r(a.status+" "+a.statusText)})};this.execute=function(){var c=new XMLHttpRequest;d.active=!0;
f.requests+=1;c.open("GET",h,!0);c.responseType=q;c.onload=function(a){if(4===c.readyState)if(200===c.status){if(u(c.response),b.onload)b.onload(a.target.responseURL)}else r(c.status+" "+c.statusText)};c.onerror=function(a){r(c.status+" "+c.statusText)};c.onprogress=function(b){b=b.loaded-p;p+=b;a("bytesLoaded",b)};c.send(null)}}}}(),ANI=function(){var a,b={frame:0},c=[],d=document.querySelectorAll.bind(document);return a={status:b,init:function(){},activate:function(){},step:function(a,d){b.frame=
a;if(c[a])c[a]()},stop:function(){TWEEN.removeAll()},insert:function(a,b){"number"===typeof a&&(0===a?b():c[a]=b)},tween:function(a,b,c,d,l){return function(){(new TWEEN.Tween(a)).easing(l).to(b,c).onUpdate(d).start()}},library:{example:function(){if(SCN.meshes.data){var a={y:SCN.meshes.data.rotation.y},b={y:SCN.meshes.data.rotation.y+2*Math.PI};(new TWEEN.Tween(a)).delay(100).easing(TWEEN.Easing.Exponential.Out).to(b,2E3).repeat(0).onStart(function(a){TIM.step("TWEEN.start",a)}).onUpdate(function(b){SCN.meshes.data.rotation.y=
a.y}).onComplete(function(a){TIM.step("TWEEN.done",a)}).start()}else TIM.step("TWEEN.ignored")},intro:function(a,b){var c,f=d("table.loader")[0],e=(new THREE.Spherical).setFromVector3(new THREE.Vector3(8,8,8)),m=(new THREE.Spherical).setFromVector3(SCN.camera.position),h={alpha:.2,phi:e.phi,theta:e.theta,radius:e.radius},q={alpha:-1,phi:m.phi,theta:m.theta,radius:m.radius};return function(){(new TWEEN.Tween(h)).easing(TWEEN.Easing.Exponential.Out).to(q,a).onUpdate(function(a){c="rgba(0, 0, 0, "+(0>
h.alpha?0:h.alpha)+")";f.style.backgroundColor=c;e.set(h.radius,h.phi,h.theta);SCN.camera.position.setFromSpherical(e);SCN.camera.lookAt(SCN.home);.5<a&&(f.style.display="none")}).onComplete(b).start()}},lightset:function(a,b){return function(){}},menu:{toggle:function(b,c){var d={x:IFC.Hud.menu.position.x};return a.tween(d,{x:b},c,function(){return IFC.Hud.menu.position.setX(d.x)},TWEEN.Easing.Sinusoidal.Out)},scale:function(b,c){var d={scale:IFC.Hud.menu.scale.x};return a.tween(d,{scale:b},c,function(){return IFC.Hud.menu.scale.set(d.scale,
d.scale,1)},TWEEN.Easing.Sinusoidal.Out)}},sprite:{enter:function(a,b){var c="toggle"===a.cfg.type,d=!!a.toggled,f=a.cfg.position,e=a.cfg.material,h={width:f.width,height:f.height,opacity:c?c&&d?.9:.5:e.opacity},q={width:1.1*h.width,height:1.1*h.height,opacity:c?c&&d?.5:.9:e.opacity};return function(){(new TWEEN.Tween(h)).easing(TWEEN.Easing.Sinusoidal.Out).to(q,b).onUpdate(function(b){a.scale.set(h.width,h.height,1);a.material.opacity=h.opacity}).start()}},leave:function(a,b){var c="toggle"===a.cfg.type,
d=!!a.toggled,f=a.cfg.position,e=a.cfg.material,h={width:1.1*f.width,height:1.1*f.height,opacity:c?c&&d?.5:.9:a.material.opacity},q={width:f.width,height:f.height,opacity:c?c&&d?.9:.5:e.opacity};return function(){(new TWEEN.Tween(h)).easing(TWEEN.Easing.Sinusoidal.Out).to(q,b).onUpdate(function(b){a.scale.set(h.width,h.height,1);a.material.opacity=h.opacity}).start()}}},datetime:{add:function(a,b,c){var d={now:1E3*SIM.time.model.unix()},f={now:d.now+864E5};return function(){(new TWEEN.Tween(d)).easing(TWEEN.Easing.Quadratic.Out).to(f,
c).onUpdate(function(a){SIM.setSimTime(moment(d.now))}).start()}}},scaleGLobe:function(a,b){var c=SCN.scene.scale,d={x:a,y:a,z:a};return function(){(new TWEEN.Tween(c)).easing(TWEEN.Easing.Sinusoidal.Out).to(d,b).onUpdate(function(a){SCN.scene.scale.copy(c)}).start()}},cam2latlon:function(a,b,c){var d,f=SCN.camera.position.clone();a=TOOLS.latLongToVector3(a,b,c,0);f=(new THREE.Spherical).setFromVector3(f);a=(new THREE.Spherical).setFromVector3(a);var e={phi:f.phi,theta:f.theta,radius:SCN.camera.radius},
g={phi:a.phi,theta:a.theta,radius:c};return function(){(new TWEEN.Tween(e)).easing(TWEEN.Easing.Exponential.Out).to(g,500).onUpdate(function(a){d=new THREE.Spherical(e.radius,e.phi,e.theta);SCN.camera.position.setFromSpherical(d);SCN.camera.lookAt(SCN.home)}).onComplete(function(a){IFC.updatePointer()}).start()}},cam2vector:function(a){var b=Math.abs(RADIUS+RADIUS/2/Math.sin(Math.PI/180*SCN.camera.fov/2)),c,d=(new THREE.Spherical).setFromVector3(SCN.camera.position);a=(new THREE.Spherical).setFromVector3(a);
var e={phi:d.phi,theta:d.theta,radius:SCN.camera.radius},m={phi:a.phi,theta:a.theta,radius:b};m.theta-e.theta>Math.PI&&(m.theta+=2*Math.PI);return function(){(new TWEEN.Tween(e)).easing(TWEEN.Easing.Exponential.Out).to(m,500).onUpdate(function(a){c=new THREE.Spherical(e.radius,e.phi,e.theta);SCN.camera.position.setFromSpherical(c);SCN.camera.lookAt(SCN.home)}).start()}}}}}(),PI=Math.PI,TAU=2*PI,PI2=PI/2,RADIUS=1,LEVEL_0=0,LEVEL_1=.001,LEVEL_2=.002,LEVEL_3=.003,LEVEL_4=.004,LEVEL_5=.005,LEVEL_6=.006,
LEVEL_7=.007,KELVIN=273.15,TIMENOW=moment.utc("2017-06-20 1200","YYYY-MM-DD HHmm"),CFG={isLoaded:!1,Title:"Simulator",Camera:{cam:new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1500),pos:new THREE.Vector3(4,0,0),minDistance:RADIUS+.2,maxDistance:8},User:{ip:"",country_code:"",country_name:"Unknown",region_code:"",region_name:"",city:"",zip_code:"",time_zone:"",latitude:0,longitude:0,metro_code:0,loc_detected:!1},Device:{browser:"unknown",platform:navigator.platform,devicePixelRatio:NaN,
canMotion:!1,canOrientation:!1,canUserProximitry:!1,canDeviceProximitry:!1,maxVertexUniforms:NaN,max_texture_size:NaN,max_cube_map_texture_size:NaN,OES_texture_float:!1,OES_texture_float_linear:!1},Sim:{coordspool:{amount:5E5}},Hud:{opacityLow:.5,opacityHigh:.99},BasemapIds:[9,10,11,14],defaultBasemap:"basemaps",Faces:"right left top bottom front back".split(" "),Textures:{"transparent.face.512.png":"images/transparent.face.512.png","arcticio.logo.512.png":"images/arcticio.logo.white.512.png","red.dot.png":"images/red.dot.png",
"dot.white.128.png":"images/dot.white.128.png","logo.128.png":"images/logo.128.01.png","hud/fullscreen.png":"images/hud/fullscreen.png","hud/gear.png":"images/hud/gear.1.png","hud/graticule.png":"images/hud/graticule.3.png","hud/hamburger.png":"images/hud/hamburger.png","hud/info.png":"images/hud/info.png","hud/movie.png":"images/hud/movie.1.png","hud/reload.png":"images/hud/reload.png","hud/mask.png":"images/hud/mask.png","hud/clouds.png":"images/hud/clouds.png","hud/satellite.png":"images/hud/satellite.1.png",
"hud/seaice.png":"images/hud/seaice.png","hud/snow.png":"images/hud/snow.png","hud/space.png":"images/hud/space.png","hud/sst.png":"images/hud/sst.png","hud/temperature.png":"images/hud/temperature.01.png","hud/rain.png":"images/hud/rain.png","hud/population.png":"images/hud/population.png","oceanmask.4096x2048.grey.png":"images/spheres/oceanmask.4096x2048.grey.png"},Lightsets:{data:{sun:{intensity:.4},spot:{intensity:.4},ambient:{intensity:.4},background:{colors:[6710886,6710886,2236962,2236962]}},
snpp:{sun:{intensity:.4},spot:{intensity:.4},ambient:{intensity:.4},background:{colors:[6710886,6710886,2236962,2236962]}},normal:{sun:{intensity:0},spot:{intensity:0},ambient:{intensity:1},background:{colors:[6710886,6710886,2236962,2236962]}}},Sun:{radius:10},earth:{factor:6371,radius:RADIUS}};
CFG.Manager=function(){var a,b=[],c,d,e;return a={boot:function(){CFG.debug=a.debug;CFG.location=a.location;return a},init:function(){var c=CFG.User;a.initStore();a.probeFullscreen();a.sanitizeUrl();c.loc_detected?TIM.step("CFG.User","lat:",c.latitude,"lon:",c.longitude,c.country_code,c.country_name):TIM.step("CFG.User","location unknown");H.each(CFG.Objects,function(a,c){c.visible=void 0!==c.id?-1!==b.indexOf(c.id):!0});CFG.Camera.pos=e},probeFullscreen:function(){screenfull.enabled&&(document.querySelectorAll(".btnFullscreen")[0].src=
"images/fullscreen.grey.png")},lockOrientation:function(a){var b=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation;"orientation"in screen&&"function"===typeof screen.orientation.lock&&"function"===typeof screen.orientation.unlock?screen.orientation.lock(a).then(function(){TIM.step("CFG.lock",a)},function(){TIM.step("CFG.lock","failed")}):b&&b(a)?TIM.step("CFG.lock",a):TIM.step("CFG.lock","failed")},location:function(a){Object.assign(CFG.User,a);CFG.User.loc_detected=CFG.User.latitude||
CFG.User.longitude},probeDevice:function(){function a(b){null!==b.accelerationIncludingGravity.x&&(CFG.Device.canOrientation=!0,TIM.step("CFG.device","devicemotion detected","interval",b.interval));window.removeEventListener("devicemotion",a,!1)}function b(a){null!==a.alpha&&(CFG.Device.canOrientation=!0,TIM.step("CFG.device","deviceorientation detected","absolute",a.absolute));window.removeEventListener("deviceorientation",b,!1)}function c(a){CFG.Device.canDeviceProximitry=!0;TIM.step("CFG.device",
"deviceproximity detected",a);window.removeEventListener("deviceproximity",c,!1)}function d(a){CFG.Device.canUserProximitry=!0;TIM.step("CFG.device","userproximity detected",a);window.removeEventListener("userproximity",d,!1)}window.addEventListener("devicemotion",a,!1);window.addEventListener("deviceorientation",b,!1);window.addEventListener("deviceproximity",c,!1);window.addEventListener("userproximity",d,!1);var e=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),
h="undefined"!==typeof InstallTrigger,q=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),n=!!document.documentMode,p=!n&&!!window.StyleMedia,r=!!window.chrome&&!!window.chrome.webstore,u=(r||e)&&!!window.CSS;CFG.Device.browser=e?"Opera":h?"Forefox":q?"Safari":n?"IE":p?"Edge":r?"Chrome":u?"Blink":"unknown"},initStore:function(){var a=moment(),b=store.get("timestamp");window.onunload=function(){store.set("timestamp",
moment().valueOf())};b?(a=moment.duration(a.valueOf()-b),TIM.step("DBS.init","last use "+a.humanize()+" ago")):(TIM.step("DBS.init","new user detected"),store.clearAll(),store.set("timestamp",a.valueOf()))},sanitizeUrl:function(){var f=$jscomp.makeIterator(location.pathname.slice(1).split("/")),g=f.next().value,k=f.next().value;f=f.next().value;g&&(b="0"===g?[]:a.hash2assets(String(g)));b.length||(b=[CFG.Objects.background.id,CFG.Objects.ambient.id,CFG.Objects.spot.id,CFG.Objects.sun.id,CFG.Objects.basemaps.id]);
k&&(c=moment.utc(k,"YYYY-MM-DD-HH-mm"),c.isValid()||(c=void 0));c||(c=TIMENOW?TIMENOW:moment.utc());f&&(d=f.split(";").map(Number),3===d.length&&(e=(new THREE.Vector3).add({x:void 0!==d[0]?d[0]:2,y:void 0!==d[1]?d[1]:2,z:void 0!==d[2]?d[2]:2})));e||(e=TOOLS.latLongToVector3(CFG.User.latitude,CFG.User.longitude,CFG.earth.radius,3));e.length()<CFG.earth.radius+.01&&(e=CFG.Camera.pos.clone())},number2assets:function(a){var b,c=[];for(b=0;32>b;b++)a&1<<b&&c.push(b);return c.sort(function(a,b){return a-
b})},hash2assets:function(a){var b=[];var c=H.Base62.toNumber(String(a));for(a=0;32>a;a++)c&1<<a&&b.push(a);return b.sort(function(a,b){return a-b})},assets2hash:function(a){var b=0;if(!a.length)return null;a.forEach(function(a){b+=1<<a});return H.Base62.fromNumber(b)},debug:function(){var a={},b=[].concat($jscomp.arrayFromIterable(arguments));H.each(CFG.Objects,function(c,d){a[c]={id:d.id||"-"};H.each(d,function(d,e){if("id"===d||-1!==b.indexOf(d))a[c][d]=e})});console.log(JSON.stringify(a,null,
2))}}}().boot();
CFG.Sprites={logo:{visible:!0,type:"link",menu:!1,position:{zIndex:5,top:2,left:12,width:64,height:64},material:{opacity:.9,image:"logo.128.png"},onclick:function(a){location.reload();console.log("sprite.click",a.name)}},reload:{visible:!1,type:"toggle",menu:!1,position:{zIndex:5,bottom:18,right:18,width:48,height:48},material:{opacity:.7,image:"hud/reload.png"},onclick:function(a){location.reload();console.log("sprite.click",a.name)}},topbackdrop:{visible:!0,type:"backdrop",hover:!1,menu:!1,position:{zIndex:4.9,
top:0,width:"100%",height:72},material:{color:new THREE.Color(4473924),opacity:.5}},performance:{visible:!0,type:"toggle",menu:!1,canvas:document.createElement("CANVAS"),back:document.createElement("CANVAS"),position:{zIndex:5,bottom:18,right:18,width:128,height:64},material:{opacity:.9},onclick:function(a){a.widget.selectModus();console.log("sprite.clicked",a.name)}},time:{visible:!0,hover:!1,menu:!1,canvas:document.createElement("CANVAS"),position:{zIndex:5,top:4,center:"x",width:256,height:64},
material:{opacity:.7},onclick:function(a){console.log("sprite.clicked",a.name)}},spacetime:{visible:!0,type:"toggle",menu:!1,toggled:!1,canvas:document.createElement("CANVAS"),position:{zIndex:5,top:80,right:18,width:48,height:48},material:{opacity:.6,image:"hud/space.png"},onclick:function(a){IFC.toggleSpaceTime();a.toggled=!a.toggled;console.log("sprite.click",a.name)}},hamburger:{visible:!0,type:"toggle",menu:!1,toggled:!1,position:{zIndex:5,top:10,right:18,width:48,height:48},material:{opacity:.5,
image:"hud/hamburger.png"},onclick:function(a){IFC.Hud.toggleMenu();a.toggled=!a.toggled}},fullscreen:{type:"toggle",menu:!0,visible:screenfull.enabled,toggled:screenfull.isFullscreen,position:{zIndex:5,top:180,right:18,width:48,height:48},material:{opacity:.5,image:"hud/fullscreen.png"},onclick:function(a){screenfull.toggle(document.querySelectorAll(".fullscreen")[0]);a.toggled=!a.toggled}},movie:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:240,right:18,width:48,height:48},
material:{opacity:.5,image:"hud/movie.png"},onclick:function(a){IFC.Tools.takeScreenShot();console.log("sprite.click",a.name)}},info:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:300,right:18,width:48,height:48},material:{opacity:.5,image:"hud/info.png"},onclick:function(a){$("#homelink")[0].click()}},gear:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:80,left:18,width:48,height:48},material:{opacity:.5,image:"hud/gear.png"},onclick:function(a){IFC.toggleGUI();
console.log("sprite.clicked",a.name)}},mask:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:180,left:18,width:48,height:48},material:{opacity:.5,image:"hud/mask.png"},onclick:function(a){SCN.toggleBasemap("mask");a.toggled=!a.toggled}},snpp:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:180,left:80,width:48,height:48},material:{opacity:.5,image:"hud/satellite.png"},onclick:function(a){SCN.toggleBasemap("snpp");a.toggled=!a.toggled}},tmp2m:{visible:!0,menu:!0,
type:"toggle",toggled:!1,position:{zIndex:5,top:240,left:18,width:48,height:48},material:{opacity:.5,image:"hud/temperature.png"},onclick:function(a){SCN.toggle(SCN.objects.tmp2m);a.toggled=!a.toggled}},clouds:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:300,left:18,width:48,height:48},material:{opacity:.5,image:"hud/clouds.png"},onclick:function(a){SCN.toggle(SCN.objects.jetstream);a.toggled=!a.toggled;console.log("sprite.clicked",a.name)}},rain:{visible:!0,menu:!0,type:"toggle",
toggled:!1,position:{zIndex:5,top:300,left:80,width:48,height:48},material:{opacity:.5,image:"hud/rain.png"},onclick:function(a){SCN.toggle(SCN.objects.pratesfc);a.toggled=!a.toggled}},snow:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:360,left:18,width:48,height:48},material:{opacity:.5,image:"hud/snow.png"},onclick:function(a){a.toggled=!a.toggled;console.log("sprite.clicked",a.name)}},seaice:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:360,left:80,width:48,
height:48},material:{opacity:.5,image:"hud/seaice.png"},onclick:function(a){SCN.toggle(SCN.objects.seaice);a.toggled=!a.toggled;console.log("sprite.clicked",a.name)}},sst:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:240,left:80,width:48,height:48},material:{opacity:.5,image:"hud/sst.png"},onclick:function(a){SCN.toggle(SCN.objects.sst);a.toggled=!a.toggled;console.log("sprite.clicked",a.name)}},population:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:420,
left:15,width:54,height:54},material:{opacity:.5,image:"hud/population.png"},onclick:function(a){SCN.toggle(SCN.objects.population);a.toggled=!a.toggled;console.log("sprite.clicked",a.name)}},graticule:{visible:!0,menu:!0,type:"toggle",toggled:!1,position:{zIndex:5,top:480,left:15,width:54,height:54},material:{opacity:.5,image:"hud/graticule.png"},onclick:function(a){SCN.toggle(SCN.objects.graticule);a.toggled=!a.toggled;console.log("sprite.clicked",a.name)}}};
CFG.Objects={pointer:{title:"pointer",type:"mesh",mesh:new THREE.Mesh(new THREE.SphereGeometry(RADIUS-.01,16,16),new THREE.MeshBasicMaterial({color:3342336,wireframe:!0,transparent:!0,opacity:.1}))},background:{title:"dynamic background",type:"mesh.module",size:4,colors:[6710886,6710886,2236962,2236962]},ambient:{title:"ambient light",type:"light",color:16777215,intensity:.1,light:function(a){return new THREE.AmbientLight(a.color,a.intensity)}},spot:{title:"spot light",type:"light",color:16777215,
intensity:.9,distance:0,angle:.3,penumbra:.1,decay:0,light:function(a){return new THREE.SpotLight(a.color,a.intensity,a.distance,a.angle,a.penumbra)},pos:new THREE.Vector3(0,4,0)},sun:{title:"directional light",type:"light",skycolor:16768426,grdcolor:9013699,intensity:.4,light:function(a){return new THREE.HemisphereLight(a.skycolor,a.grdcolor,a.intensity)},pos:new THREE.Vector3(2,2,2)},basemaps:{title:"basic surface mask",type:"mesh.module",rotation:[0,Math.PI/2,0],lightset:"normal",cube:{type:"globe",
radius:RADIUS,texture:"images/data/globe.data.FACE.512.comp.png",material:{transparent:!0,opacity:.99,side:THREE.DoubleSide}}},graticule:{id:5,visible:!1,title:"graticule",type:"mesh.calculated",altitude:.01,resolution:10,material:{transparent:!0,opacity:.2,color:14540253}},atmosphere:{id:6,visible:!1,title:"atmosphere",type:"mesh.module",radius:RADIUS+LEVEL_7,rotation:[0,.5*Math.PI,0],opacity:.5},basecopy:{id:9,visible:!1,title:"simple surface layer",type:"mesh.module",rotation:[0,Math.PI/2,0],lightset:"normal",
cube:{type:"globe",radius:RADIUS+.01,texture:"images/gmlc/globe.gmlc.FACE.512.png",material:{transparent:!0,opacity:.99,side:THREE.DoubleSide}}},rtopo2:{id:10,visible:!1,title:"RTOPO2 surface layer",type:"cube.textured",rotation:[0,Math.PI/2,0],lightset:"normal",cube:{type:"globe",radius:RADIUS+.01,texture:"images/rtopo2/globe.rtopo2.FACE.4096.png",material:{transparent:!0,opacity:.99,side:THREE.DoubleSide}}},gmlc:{id:11,visible:!1,title:"GLCNMO - vegetation layer",type:"cube.textured",rotation:[0,
Math.PI/2,0],lightset:"normal",cube:{type:"globe",radius:RADIUS+.01,texture:"images/gmlc/globe.gmlc.FACE.4096.png",material:{transparent:!0,opacity:.99,side:THREE.DoubleSide}}},snpp:{id:14,visible:!1,type:"cube.textured",title:"SNPP - satellite surface layer",rotation:[0,Math.PI/2,0],lightset:"snpp",cube:{type:"globe",radius:RADIUS+LEVEL_1,texture:"data/snpp/2017-06-15.globe.snpp.FACE.2048.jpg",material:{transparent:!0,opacity:.99,side:THREE.DoubleSide}}},sst:{id:15,visible:!1,title:"sea surface temperature",
type:"cube.textured",rotation:[0,Math.PI/2,0],cube:{type:"globe",radius:RADIUS+LEVEL_2,texture:"data/sst/2017-06-13.globe.sst.FACE.1024.png",material:{transparent:!0,opacity:.5,side:THREE.DoubleSide}}},seaice:{id:16,visible:!1,title:"AMSR2 sea ice concentration",type:"cube.textured",rotation:[0,.5*Math.PI,0],cube:{type:"polar",radius:RADIUS+LEVEL_3,texture:"data/amsr2/2017-06-13.polar.amsr2.FACE.1024.grey.trans.png",material:{transparent:!0,opacity:.99,side:THREE.DoubleSide}}},wind:{id:17,visible:!1,
title:"GFS - wind 10m",type:"simulation",subtype:"multiline",rotation:[0,Math.PI,0],radius:RADIUS+LEVEL_4,color:new THREE.Color("#ff0000"),opacity:.5,lineWidth:RADIUS*Math.PI/180*.2,section:.55,length:60,amount:512,sim:{data:["data/gfs/tmp2m/2017-06-13-12.tmp2m.10.dods","data/gfs/ugrd10m/2017-06-13-12.ugrd10m.10.dods","data/gfs/vgrd10m/2017-06-13-12.vgrd10m.10.dods"],sectors:[[89.9,-180,45,180],[-45,-180,-89.9,180],[45,-180,-45,-90],[45,-90,-45,0],[45,0,-45,90],[45,90,-45,180]]}},jetstream:{id:18,
visible:!1,title:"GFS - jetstream at 300hpa",type:"simulation",subtype:"multiline",rotation:[0,Math.PI,0],radius:RADIUS+LEVEL_6,color:new THREE.Color("#ff0000"),opacity:.8,lineWidth:RADIUS*Math.PI/180*.1,section:.55,length:60,amount:512,hue:220,sim:{dataroot:"data/gfs/",patterns:["[ugrdprs/]YYYY-MM-DD-HH[.ugrdprs.10.dods]","[vgrdprs/]YYYY-MM-DD-HH[.vgrdprs.10.dods]"],sectors:[[89.9,-180,45,180],[-45,-180,-89.9,180],[45,-180,-45,-90],[45,-90,-45,0],[45,0,-45,90],[45,90,-45,180]]}},clouds:{id:19,visible:!1,
title:"GFS - total cloud cover",type:"simulation",rotation:[0,Math.PI,0],radius:RADIUS+LEVEL_5,amount:1E5,size:8,sim:{dataroot:"data/gfs/tcdcclm/",patterns:["YYYY-MM-DD-HH[.tcdcclm.10.dods]"],sectors:[[89.99,-180,-89.99,180]]}},variables:{id:20,visible:!1,title:"GFS - generic layer",type:"simulation",rotation:[0,PI-PI/360,0],radius:RADIUS+LEVEL_4,sim:{variable:"tmp2m",dataroot:"data/gfs/tmp2m/",patterns:["YYYY-MM-DD-HH[.tmp2m.10.dods]"]}},tmp2m:{id:21,visible:!1,title:"GFS - air temperature at 2m",
type:"simulation",geometry:new THREE.SphereBufferGeometry(RADIUS+LEVEL_4,64,32),rotation:[0,PI-PI/360,0],radius:RADIUS+LEVEL_4,opacity:.5,sim:{variable:"tmp2m",step:[6,"hours"],dataroot:"data/gfs/tmp2m/",patterns:["YYYY-MM-DD-HH[.tmp2m.10.dods]"],palette:{"-30":new THREE.Color(11167402),"-20":new THREE.Color(13540325),"-10":new THREE.Color(7786210),"  0":new THREE.Color(7139180),"+10":new THREE.Color(15595884),"+20":new THREE.Color(16759637),"+30":new THREE.Color(16475470),"+40":new THREE.Color(13385792),
999:new THREE.Color(12263679)}}},pratesfc:{id:22,visible:!1,title:"GFS - surface precipitation rate",type:"simulation",rotation:[0,PI-PI/360,0],radius:RADIUS+LEVEL_4,sim:{variable:"pratesfc",dataroot:"data/gfs/pratesfc/",patterns:["YYYY-MM-DD-HH[.pratesfc.10.dods]"]}},land:{id:23,visible:!1,title:"geojson land",radius:RADIUS+LEVEL_3,type:"geo.json",rotation:[0,Math.PI/2,0],json:"data/json/countries_states.geojson",color:new THREE.Color("#888888")},rivers:{id:24,visible:!1,title:"geojson rivers",type:"geo.json",
radius:RADIUS+LEVEL_3,rotation:[0,Math.PI/2,0],json:"data/json/rivers.geojson",color:new THREE.Color("#888888")},population:{id:25,visible:!1,title:"3000 cities",type:"mesh.module",altitude:LEVEL_0,opacity:.8,radius:RADIUS,color:new THREE.Color(16711935)},sector:{id:27,visible:!1,title:"sector marker",type:"mesh.calculated",altitude:LEVEL_6,resolution:1,sector:[15,-15,-15,15],material:{transparent:!0,opacity:.8,color:16711935,linewidth:1.1,vertexColors:THREE.NoColors}},axes:{id:28,visible:!1,title:"3D axes",
type:"mesh",mesh:new THREE.AxisHelper(4*RADIUS)},pixels:{id:30,visible:!1,type:"mesh.module",title:"experiment",texture:"tex7.jpg"}};"use strict";
CFG.Preset={init:function(){Object.assign(CFG.Preset,{Render:!0,Reload:function(){return location.reload()},ResetCam:function(){return SCN.reset.controller()},Ambient:{isFolder:!0,toggle:CFG.Objects.ambient.visible,intensity:{val:CFG.Objects.ambient.intensity,min:0,max:1},color:"#ffffff"},Spot:{isFolder:!0,toggle:CFG.Objects.spot.visible,angle:{val:.26,min:0,max:.5},intensity:{val:CFG.Objects.spot.intensity,min:0,max:1},color:"#ffffff"},Sun:{isFolder:!0,toggle:CFG.Objects.sun.visible,intensity:{val:CFG.Objects.sun.intensity,
min:0,max:1},skycolor:CFG.Objects.sun.skycolor,grdcolor:CFG.Objects.sun.grdcolor},Atmosphere:{isFolder:!0,toggle:CFG.Objects.atmosphere.visible,opacity:{val:CFG.Objects.atmosphere.opacity,min:0,max:1}},Assets:function(){var a={isFolder:!0};H.each(CFG.Objects,function(b,c){c.id&&(a[b.toUpperCase()]=CFG.Objects[b].visible)});return a}(),DateTime:{isFolder:!0,choose:{val:3,min:0,max:8759,step:1},"hour  +1":function(){},"hour  -1":function(){},"hour  +6":function(){},"hour  -6":function(){},"hour +24":function(){},
"hour -24":function(){},"day  +30":function(){},"day  -30":function(){}},Animations:{isFolder:!0,Rotate:function(){}}})}};
SIM=function(){var a;document.querySelectorAll.bind(document)(".panel.image");var b=null,c={},d={},e=Orb.SolarSystem().Sun(),f=new THREE.Vector3,g=new THREE.Vector3,k=new THREE.Spherical(4,0,-PI2),l=new THREE.Vector3,m=dataTimeRanges.hypatia,h={iso:"",doe:NaN,start:moment.utc("2017-01-01-00","YYYY-MM-DD-HH"),end:moment.utc("2017-12-31-18","YYYY-MM-DD-HH"),now:moment.utc(),model:null,range:H.range(-12,66,6),stamps:null,mindoe:NaN,maxdoe:NaN,fmtDay:"",fmtHour:""};return a={Models:{},time:h,models:c,
datagrams:d,coordsPool:b,sunVector:f,sunPosition:l,sunDirection:g,calcdoe:function(a){return H.date2doeFloat(a.toDate())},mom2doe:function(a){return a.toDate()/864E5},doe2mom:function(a){return moment.utc(864E5*a)},init:function(){var c=Date.now();b=a.coordsPool=(new CoordsPool(CFG.Sim.coordspool.amount)).generate();TIM.step("Pool.generate",Date.now()-c,"ms",CFG.Sim.coordspool.amount);h.interval=216E5;h.now=TIMENOW.clone();h.model=TIMENOW.clone();h.doe=a.calcdoe(h.model)},setSimTime:function(b,c){if(void 0===
b&&void 0===c)b=TIMENOW,h.model=b.clone().hours(b.hours()-b.hours()%6),h.stamps=h.range.map(function(a){return h.model.clone().add(a,"hours")}),h.length=h.stamps.length,h.mindoe=a.mom2doe(h.stamps[0]),h.maxdoe=a.mom2doe(h.stamps.slice(-1)[0]);else if("number"===typeof b&&void 0===c)h.model=h.start.clone().add(b,"hours");else if("number"===typeof b&&-1!==["minutes","hours","days"].indexOf(c))h.model.add(b,c);else if("number"===typeof b){debugger;h.model.add(b,c)}else if(b._isAMomentObject)h.model=
b.clone();else{debugger;console.log("WTF")}h.model=h.model.valueOf()>h.stamps[h.stamps.length-1].valueOf()?h.stamps[h.stamps.length-1]:h.model;h.iso=h.model.format("YYYY-MM-DD HH");h.doe=a.mom2doe(h.model);h.fmtDay=h.model.format("YYYY-MM-DD");h.fmtHour=h.model.format("HH:mm [UTC]");IFC.urlDirty=!0},updateSun:function(){var a=new Orb.Time(h.model.toDate());var b=e.position.equatorial(a);a=(h.model.hour()+h.model.minutes()/60)*(Math.PI/12);b=b.dec*Math.PI/180-Math.PI/2;k.set(4,0,-PI/2);k.theta-=a;
k.phi-=b;f.setFromSpherical(k);g.copy(f).normalize();l.copy(g).multiplyScalar(CFG.Sun.radius)},calcVariTimes:function(a,b){var c=m[a];b=b.sim.step;for(var d={mindoe:NaN,maxdoe:NaN,does:[],moms:[]},e=moment.utc(c[0],"YYYY-MM-DD-HH"),f=moment.utc(c[1],"YYYY-MM-DD-HH");e.valueOf()<=f.valueOf();)d.moms.push(e.clone()),d.does.push(SIM.mom2doe(e)),e.add(b[0],b[1]);d.length=d.does.length;d.mindoe=d.does[0];d.maxdoe=d.does[d.length-1];TIM.step("SIM.times",a,c,d.length,d.mindoe,d.maxdoe);return d},loadVariable:function(b,
e,f){!SIM.Models[b]&&console.log('Model: "'+b+'" not avail, have:',Object.keys(SIM.Models));var g,k,l=a.calcVariTimes(b,e),m=SIM.Models[b].create(e,l);c[b]=m;RES.load({urls:m.urls,onFinish:function(a,e){if(a)throw a;e.forEach(function(a){k=new SIM.Datagram(a.data);g=k.vari;d[g]?d[g].append(k):d[g]=k});m.prepare();TIM.step("SIM.load",g,h.doe);f(b,c[b].obj)}})}}}();
SIM.Vars={tmp2m:{color:"#C24642",legend:"Temperature (2m, \u00b0C)",axis:"primary",letter:"T",unit:"C",adjust:function(a){return a-273.15},name:"Temperature, 2m",description:"2 m above ground temperature [k]",wiki:null},prmslmsl:{color:"#369EAD",legend:"Pressure (msl)",axis:"secondary",letter:"P",unit:"hpa",range:[950,1050],adjust:function(a){return a/100},name:"Sea Level Pressure",description:"mean sea level pressure reduced to msl [hpa]",wiki:null},apcpsfc:{color:"#76cee2",legend:"Precipitation (kg/m^2)",
axis:"primary",letter:"PC",unit:"kg/m^2",adjust:null,name:null,description:"surface total precipitation [kg/m^2]",wiki:null},gustsfc:{range:[0,30],color:"#6cef6c",legend:"SFC wind speed (gust, m/s)",axis:"secondary",letter:"G",unit:"m/s",adjust:null,name:null,description:"surface wind speed (gust) [m/s] ",wiki:null},dlwrfsfc:{range:[0,.5,1,1.5],color:"#ffbb55",legend:"Long wave (down, kw/m^2)",axis:"primary",letter:"LW",unit:"kw/m^2",adjust:function(a){return a/1E3},name:null,description:"surface downward long-wave rad. flux [w/m^2]",
wiki:null},dswrfsfc:{range:[0,.5,1,1.5],color:"#ce9be5",legend:"Short wave (down, kw/m^2)",axis:"secondary",letter:"SW",unit:"kw/m^2",adjust:function(a){return a/1E3},name:null,description:"surface downward short-wave rad. flux [w/m^2]",wiki:null},absvprs:{unit:"1/s",adjust:null,name:null,description:"(1000 975 950 925 900.. 7 5 3 2 1) absolute vorticity [1/s]",wiki:null},no4lftxsfc:{unit:"k",adjust:null,name:null,description:"surface best (4 layer) lifted index [k]",wiki:"http://en.wikipedia.org/wiki/Lifted_index"},
no5wava500mb:{unit:"gpm",adjust:null,name:null,description:"500 mb 5-wave geopotential height anomaly [gpm]",wiki:null},no5wavh500mb:{unit:"gpm",adjust:null,name:null,description:"500 mb 5-wave geopotential height [gpm]",wiki:null},acpcpsfc:{unit:"kg/m^2",adjust:null,name:null,description:"surface convective precipitation [kg/m^2]",wiki:null},albdosfc:{unit:"%",adjust:null,name:"Albedo",description:"surface albedo [%]",wiki:null},capesfc:{unit:"j/kg",adjust:null,name:null,description:"surface convective available potential energy [j/kg]",
wiki:null},cape180_0mb:{unit:"j/kg",adjust:null,name:null,description:"180-0 mb above ground convective available potential energy [j/kg]",wiki:null},cduvbsfc:{unit:"w/m^2",adjust:null,name:null,description:"surface clear sky uv-b downward solar flux [w/m^2]",wiki:null},cfrzrsfc:{unit:"non-dim",adjust:null,name:null,description:"surface categorical freezing rain (yes=1; no=0) [non-dim]",wiki:null},cicepsfc:{unit:"non-dim",adjust:null,name:null,description:"surface categorical ice pellets (yes=1; no=0) [non-dim]",
wiki:null},cinsfc:{unit:"j/kg",adjust:null,name:null,description:"surface convective inhibition [j/kg]",wiki:"http://en.wikipedia.org/wiki/Convective_inhibition"},cin180_0mb:{unit:"j/kg",adjust:null,name:null,description:"180-0 mb above ground convective inhibition [j/kg]",wiki:"http://en.wikipedia.org/wiki/Convective_inhibition"},clwmrprs:{unit:"kg/kg",adjust:null,name:null,description:"(1000 975 950 925 900.. 200 175 150 125 100) cloud mixing ratio [kg/kg]",wiki:null},cnwatsfc:{unit:"kg/m^2",adjust:null,
name:null,description:"surface plant canopy surface water [kg/m^2]",wiki:null},cpratsfc:{unit:"kg/m^2/s",adjust:null,name:null,description:"surface convective precipitation rate [kg/m^2/s]",wiki:null},crainsfc:{unit:"non-dim",adjust:null,name:null,description:"surface categorical rain (yes=1; no=0) [non-dim]",wiki:null},csnowsfc:{unit:"non-dim",adjust:null,name:"Snow Cover",description:"surface categorical snow (yes=1; no=0) [non-dim]",wiki:null},cwatclm:{unit:"kg/m^2",adjust:null,name:null,description:"entire atmosphere (considered as a single layer) cloud water [kg/m^2]",
wiki:null},cworkclm:{unit:"j/kg",adjust:null,name:null,description:"entire atmosphere (considered as a single layer) cloud work function [j/kg]",wiki:null},duvbsfc:{unit:"w/m^2",adjust:null,name:null,description:"surface uv-b downward solar flux [w/m^2]",wiki:null},fldcpsfc:{unit:"fraction",adjust:null,name:null,description:"surface field capacity [fraction]",wiki:null},gfluxsfc:{unit:"w/m^2",adjust:null,name:"Ground Flux",description:"surface ground heat flux [w/m^2]",wiki:null},gpa1000mb:{unit:"gpm",
adjust:null,name:null,description:"1000 mb geopotential height anomaly [gpm]",wiki:null},gpa500mb:{unit:"gpm",adjust:null,name:null,description:"500 mb geopotential height anomaly [gpm]",wiki:null},hgtsfc:{unit:"gpm",adjust:null,name:null,description:"surface geopotential height [gpm]",wiki:null},hgtprs:{unit:"gpm",adjust:null,name:null,description:"(1000 975 950 925 900.. 7 5 3 2 1) geopotential height [gpm]",wiki:null},hgt2pv:{unit:"gpm",adjust:null,name:null,description:"pv=2e-06 (km^2/kg/s) surface geopotential height [gpm]",
wiki:null},hgtneg2pv:{unit:"gpm",adjust:null,name:null,description:"pv=-2e-06 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},hgt0p5pv:{unit:"gpm",adjust:null,name:null,description:"pv=5e-07 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},hgtneg0p5pv:{unit:"gpm",adjust:null,name:null,description:"pv=-5e-07 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},hgt1pv:{unit:"gpm",adjust:null,name:null,description:"pv=1e-06 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},
hgtneg1pv:{unit:"gpm",adjust:null,name:null,description:"pv=-1e-06 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},hgt1p5pv:{unit:"gpm",adjust:null,name:null,description:"pv=1.5e-06 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},hgtneg1p5pv:{unit:"gpm",adjust:null,name:null,description:"pv=-1.5e-06 (km^2/kg/s) surface geopotential height [gpm]",wiki:null},hgttop0c:{unit:"gpm",adjust:null,name:null,description:"highest tropospheric freezing level geopotential height [gpm]",wiki:null},
hgt0c:{unit:"gpm",adjust:null,name:null,description:"0c isotherm geopotential height [gpm]",wiki:null},hgtmwl:{unit:"gpm",adjust:null,name:null,description:"max wind geopotential height [gpm]",wiki:null},hgttrop:{unit:"gpm",adjust:null,name:null,description:"tropopause geopotential height [gpm]",wiki:"http://en.wikipedia.org/wiki/Tropopause"},hpblsfc:{unit:"m",adjust:null,name:null,description:"surface planetary boundary layer height [m]",wiki:"http://en.wikipedia.org/wiki/Planetary_boundary_layer"},
icecsfc:{unit:"prop.",adjust:null,name:"Sea Ice",description:"surface ice cover [proportion]",wiki:null},icetksfc:{unit:"m",adjust:null,name:"Sea Ice Thickness",description:"surface ice thickness [m]",wiki:null},landsfc:{unit:"prop.",adjust:null,name:"Land/Sea",description:"surface land cover (1=land, 0=sea) [proportion]",wiki:null},lftxsfc:{unit:"k",adjust:null,name:null,description:"surface surface lifted index [k]",wiki:"http://en.wikipedia.org/wiki/Lifted_index"},lhtflsfc:{unit:"w/m^2",adjust:null,
name:null,description:"surface latent heat net flux [w/m^2]",wiki:null},o3mrprs:{unit:"kg/kg",adjust:null,name:null,description:"(100 70 50 30 20 10 7 5 3 2 1) ozone mixing ratio [kg/kg]",wiki:null},pevprsfc:{unit:"w/m^2",adjust:null,name:null,description:"surface potential evaporation rate [w/m^2]",wiki:null},potsig995:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"0.995 sigma level potential temperature [k]",wiki:null},pratesfc:{unit:"g/m^2/s",adjust:function(a){return 1E3*
a},name:null,description:"surface precipitation rate [g/m^2/s]",wiki:null},preslclb:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"low cloud bottom level pressure [hpa]",wiki:null},preslclt:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"low cloud top level pressure [hpa]",wiki:null},presmclb:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"middle cloud bottom level pressure [hpa]",wiki:null},presmclt:{unit:"hpa",adjust:function(a){return a/
100},name:null,description:"middle cloud top level pressure [hpa]",wiki:null},preshclb:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"high cloud bottom level pressure [hpa]",wiki:null},preshclt:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"high cloud top level pressure [hpa]",wiki:null},pressfc:{unit:"hpa",adjust:function(a){return a/100},name:"Surface Pressure",description:"surface pressure [hpa]",wiki:null},pres2pv:{unit:"hpa",adjust:function(a){return a/
100},name:null,description:"pv=2e-06 (km^2/kg/s) surface pressure [hpa]",wiki:null},presneg2pv:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"pv=-2e-06 (km^2/kg/s) surface pressure [hpa]",wiki:null},pres0p5pv:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"pv=5e-07 (km^2/kg/s) surface pressure [hpa]",wiki:null},presneg0p5pv:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"pv=-5e-07 (km^2/kg/s) surface pressure [hpa]",wiki:null},pres1pv:{unit:"hpa",
adjust:function(a){return a/100},name:null,description:"pv=1e-06 (km^2/kg/s) surface pressure [hpa]",wiki:null},presneg1pv:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"pv=-1e-06 (km^2/kg/s) surface pressure [hpa]",wiki:null},pres1p5pv:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"pv=1.5e-06 (km^2/kg/s) surface pressure [hpa]",wiki:null},presneg1p5pv:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"pv=-1.5e-06 (km^2/kg/s) surface pressure [hpa]",
wiki:null},prescclb:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"convective cloud bottom level pressure [hpa]",wiki:null},prescclt:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"convective cloud top level pressure [hpa]",wiki:null},presmwl:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"max wind pressure [hpa]",wiki:null},prestrop:{unit:"hpa",adjust:function(a){return a/100},name:null,description:"tropopause pressure [hpa]",wiki:null},
pwatclm:{unit:"kg/m^2",adjust:null,name:null,description:"entire atmosphere (considered as a single layer) precipitable water [kg/m^2]",wiki:null},rhprs:{unit:"%",adjust:null,name:null,description:"(1000 975 950 925 900.. 200 175 150 125 100) relative humidity [%]",wiki:null},rh2m:{unit:"%",adjust:null,name:"Humidity, 2m",description:"2 m above ground relative humidity [%]",wiki:null},rhsg330_1000:{unit:"%",adjust:null,name:null,description:"0.33-1 sigma layer relative humidity [%]",wiki:null},rhsg440_1000:{unit:"%",
adjust:null,name:null,description:"0.44-1 sigma layer relative humidity [%]",wiki:null},rhsg720_940:{unit:"%",adjust:null,name:null,description:"0.72-0.94 sigma layer relative humidity [%]",wiki:null},rhsg440_720:{unit:"%",adjust:null,name:null,description:"0.44-0.72 sigma layer relative humidity [%]",wiki:null},rhsig995:{unit:"%",adjust:null,name:null,description:"0.995 sigma level relative humidity [%]",wiki:null},rh30_0mb:{unit:"%",adjust:null,name:null,description:"30-0 mb above ground relative humidity [%]",
wiki:null},rh60_30mb:{unit:"%",adjust:null,name:null,description:"60-30 mb above ground relative humidity [%]",wiki:null},rh90_60mb:{unit:"%",adjust:null,name:null,description:"90-60 mb above ground relative humidity [%]",wiki:null},rh120_90mb:{unit:"%",adjust:null,name:null,description:"120-90 mb above ground relative humidity [%]",wiki:null},rh150_120mb:{unit:"%",adjust:null,name:null,description:"150-120 mb above ground relative humidity [%]",wiki:null},rh180_150mb:{unit:"%",adjust:null,name:null,
description:"180-150 mb above ground relative humidity [%]",wiki:null},rhclm:{unit:"%",adjust:null,name:"Humidity, Atmosphere",description:"entire atmosphere (considered as a single layer) relative humidity [%]",wiki:null},rhtop0c:{unit:"%",adjust:null,name:null,description:"highest tropospheric freezing level relative humidity [%]",wiki:null},rh0c:{unit:"%",adjust:null,name:null,description:"0c isotherm relative humidity [%]",wiki:null},shtflsfc:{unit:"w/m^2",adjust:null,name:null,description:"surface sensible heat net flux [w/m^2]",
wiki:null},snodsfc:{unit:"m",adjust:null,name:"Snow Depth",description:"surface snow depth [m]",wiki:null},soill0_10cm:{unit:"prop.",adjust:null,name:null,description:"0-0.1 m below ground liquid volumetric soil moisture (non frozen) [proportion]",wiki:null},soill10_40cm:{unit:"prop.",adjust:null,name:null,description:"0.1-0.4 m below ground liquid volumetric soil moisture (non frozen) [proportion]",wiki:null},soill40_100cm:{unit:"prop.",adjust:null,name:null,description:"0.4-1 m below ground liquid volumetric soil moisture (non frozen) [proportion]",
wiki:null},soill100_200cm:{unit:"prop.",adjust:null,name:null,description:"1-2 m below ground liquid volumetric soil moisture (non frozen) [proportion]",wiki:null},soilw0_10cm:{unit:"fraction",adjust:null,name:null,description:"0-0.1 m below ground volumetric soil moisture content [fraction]",wiki:null},soilw10_40cm:{unit:"fraction",adjust:null,name:null,description:"0.1-0.4 m below ground volumetric soil moisture content [fraction]",wiki:null},soilw40_100cm:{unit:"fraction",adjust:null,name:null,
description:"0.4-1 m below ground volumetric soil moisture content [fraction]",wiki:null},soilw100_200cm:{unit:"fraction",adjust:null,name:null,description:"1-2 m below ground volumetric soil moisture content [fraction]",wiki:null},spfhprs:{unit:"kg/kg",adjust:null,name:null,description:"(1000 975 950 925 900.. 200 175 150 125 100) specific humidity [kg/kg]",wiki:null},spfh2m:{unit:"g/kg",adjust:function(a){return 1E3*a},name:null,description:"2 m above ground specific humidity [g/kg]",wiki:null},
spfh30_0mb:{unit:"g/kg",adjust:function(a){return 1E3*a},name:null,description:"30-0 mb above ground specific humidity [g/kg]",wiki:null},spfh60_30mb:{unit:"kg/kg",adjust:null,name:null,description:"60-30 mb above ground specific humidity [kg/kg]",wiki:null},spfh90_60mb:{unit:"kg/kg",adjust:null,name:null,description:"90-60 mb above ground specific humidity [kg/kg]",wiki:null},spfh120_90mb:{unit:"kg/kg",adjust:null,name:null,description:"120-90 mb above ground specific humidity [kg/kg]",wiki:null},
spfh150_120mb:{unit:"kg/kg",adjust:null,name:null,description:"150-120 mb above ground specific humidity [kg/kg]",wiki:null},spfh180_150mb:{unit:"kg/kg",adjust:null,name:null,description:"180-150 mb above ground specific humidity [kg/kg]",wiki:null},tcdcclm:{unit:"%",adjust:null,name:"Cloud Cover",description:"entire atmosphere (considered as a single layer) total cloud cover [%]",wiki:null},tcdcblcll:{unit:"%",adjust:null,name:null,description:"boundary layer cloud layer total cloud cover [%]",wiki:null},
tcdclcll:{unit:"%",adjust:null,name:null,description:"low cloud layer total cloud cover [%]",wiki:null},tcdcmcll:{unit:"%",adjust:null,name:null,description:"middle cloud layer total cloud cover [%]",wiki:null},tcdchcll:{unit:"%",adjust:null,name:null,description:"high cloud layer total cloud cover [%]",wiki:null},tcdcccll:{unit:"%",adjust:null,name:null,description:"convective cloud layer total cloud cover [%]",wiki:null},tmax2m:{unit:"C",adjust:function(a){return a-273.15},name:"Temperature, max, 2m",
description:"2 m above ground maximum temperature [k]",wiki:null},tmin2m:{unit:"C",adjust:function(a){return a-273.15},name:"Temperature, min, 2m",description:"2 m above ground minimum temperature [k]",wiki:null},tmplclt:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"low cloud top level temperature [k]",wiki:null},tmpmclt:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"middle cloud top level temperature [k]",wiki:null},tmphclt:{unit:"C",adjust:function(a){return a-
273.15},name:null,description:"high cloud top level temperature [k]",wiki:null},tmpsfc:{unit:"C",adjust:function(a){return a-273.15},name:"Surface Temperature",description:"surface temperature [k]",wiki:null},tmpprs:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"(1000 975 950 925 900.. 7 5 3 2 1) temperature [k]",wiki:null},tmp_1829m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"1829 m above mean sea level temperature [k]",wiki:null},tmp_2743m:{unit:"C",
adjust:function(a){return a-273.15},name:null,description:"2743 m above mean sea level temperature [k]",wiki:null},tmp_3658m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"3658 m above mean sea level temperature [k]",wiki:null},tmp_305m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"305 m above mean sea level temperature [k]",wiki:null},tmp_457m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"457 m above mean sea level temperature [k]",
wiki:null},tmp_610m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"610 m above mean sea level temperature [k]",wiki:null},tmp_914m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"914 m above mean sea level temperature [k]",wiki:null},tmp_4572m:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"4572 m above mean sea level temperature [k]",wiki:null},tmpsig995:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"0.995 sigma level temperature [k]",
wiki:null},tmp0_10cm:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"0-0.1 m below ground temperature [k]",wiki:null},tmp10_40cm:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"0.1-0.4 m below ground temperature [k]",wiki:null},tmp40_100cm:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"0.4-1 m below ground temperature [k]",wiki:null},tmp100_200cm:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"1-2 m below ground temperature [k]",
wiki:null},tmp30_0mb:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"30-0 mb above ground temperature [k]",wiki:null},tmp60_30mb:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"60-30 mb above ground temperature [k]",wiki:null},tmp90_60mb:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"90-60 mb above ground temperature [k]",wiki:null},tmp120_90mb:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"120-90 mb above ground temperature [k]",
wiki:null},tmp150_120mb:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"150-120 mb above ground temperature [k]",wiki:null},tmp180_150mb:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"180-150 mb above ground temperature [k]",wiki:null},tmp2pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=2e-06 (km^2/kg/s) surface temperature [k]",wiki:null},tmpneg2pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=-2e-06 (km^2/kg/s) surface temperature [k]",
wiki:null},tmp0p5pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=5e-07 (km^2/kg/s) surface temperature [k]",wiki:null},tmpneg0p5pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=-5e-07 (km^2/kg/s) surface temperature [k]",wiki:null},tmp1pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=1e-06 (km^2/kg/s) surface temperature [k]",wiki:null},tmpneg1pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=-1e-06 (km^2/kg/s) surface temperature [k]",
wiki:null},tmp1p5pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=1.5e-06 (km^2/kg/s) surface temperature [k]",wiki:null},tmpneg1p5pv:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"pv=-1.5e-06 (km^2/kg/s) surface temperature [k]",wiki:null},tmpmwl:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"max wind temperature [k]",wiki:null},tmptrop:{unit:"C",adjust:function(a){return a-273.15},name:null,description:"tropopause temperature [k]",
wiki:null},tozneclm:{unit:"dobson",adjust:null,name:"Ozone, Atmosphere",description:"entire atmosphere (considered as a single layer) total ozone [dobson]",wiki:null},ugwdsfc:{unit:"n/m^2",adjust:null,name:null,description:"surface zonal flux of gravity wave stress [n/m^2]",wiki:"http://en.wikipedia.org/wiki/Gravity_wave"},vgwdsfc:{unit:"n/m^2",adjust:null,name:null,description:"surface meridional flux of gravity wave stress [n/m^2]",wiki:"http://en.wikipedia.org/wiki/Gravity_wave"},uflxsfc:{unit:"n/m^2",
adjust:null,name:null,description:"surface momentum flux, u-component [n/m^2]",wiki:"http://glossary.ametsoc.org/wiki/Momentum_flux"},vflxsfc:{unit:"n/m^2",adjust:null,name:null,description:"surface momentum flux, v-component [n/m^2]",wiki:"http://glossary.ametsoc.org/wiki/Momentum_flux"},ugrdprs:{unit:"m/s",adjust:null,name:null,description:"(1000 975 950 925 900.. 7 5 3 2 1) u-component of wind [m/s]",wiki:null},ugrd_1829m:{unit:"m/s",adjust:null,name:null,description:"1829 m above mean sea level u-component of wind [m/s]",
wiki:null},ugrd_2743m:{unit:"m/s",adjust:null,name:null,description:"2743 m above mean sea level u-component of wind [m/s]",wiki:null},ugrd_3658m:{unit:"m/s",adjust:null,name:null,description:"3658 m above mean sea level u-component of wind [m/s]",wiki:null},ugrd_305m:{unit:"m/s",adjust:null,name:null,description:"305 m above mean sea level u-component of wind [m/s]",wiki:null},ugrd_457m:{unit:"m/s",adjust:null,name:null,description:"457 m above mean sea level u-component of wind [m/s]",wiki:null},
ugrd_610m:{unit:"m/s",adjust:null,name:null,description:"610 m above mean sea level u-component of wind [m/s]",wiki:null},ugrd_914m:{unit:"m/s",adjust:null,name:null,description:"914 m above mean sea level u-component of wind [m/s]",wiki:null},ugrd_4572m:{unit:"m/s",adjust:null,name:null,description:"4572 m above mean sea level u-component of wind [m/s]",wiki:null},ugrd10m:{unit:"m/s",adjust:null,name:"Wind, 10m, U",description:"10 m above ground u-component of wind [m/s]",wiki:null},ugrdsig995:{unit:"m/s",
adjust:null,name:null,description:"0.995 sigma level u-component of wind [m/s]",wiki:null},ugrd30_0mb:{unit:"m/s",adjust:null,name:null,description:"30-0 mb above ground u-component of wind [m/s]",wiki:null},ugrd60_30mb:{unit:"m/s",adjust:null,name:null,description:"60-30 mb above ground u-component of wind [m/s]",wiki:null},ugrd90_60mb:{unit:"m/s",adjust:null,name:null,description:"90-60 mb above ground u-component of wind [m/s]",wiki:null},ugrd120_90mb:{unit:"m/s",adjust:null,name:null,description:"120-90 mb above ground u-component of wind [m/s]",
wiki:null},ugrd150_120mb:{unit:"m/s",adjust:null,name:null,description:"150-120 mb above ground u-component of wind [m/s]",wiki:null},ugrd180_150mb:{unit:"m/s",adjust:null,name:null,description:"180-150 mb above ground u-component of wind [m/s]",wiki:null},ugrd2pv:{unit:"m/s",adjust:null,name:null,description:"pv=2e-06 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrdneg2pv:{unit:"m/s",adjust:null,name:null,description:"pv=-2e-06 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},
ugrd0p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=5e-07 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrdneg0p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=-5e-07 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrd1pv:{unit:"m/s",adjust:null,name:null,description:"pv=1e-06 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrdneg1pv:{unit:"m/s",adjust:null,name:null,description:"pv=-1e-06 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrd1p5pv:{unit:"m/s",
adjust:null,name:null,description:"pv=1.5e-06 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrdneg1p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=-1.5e-06 (km^2/kg/s) surface u-component of wind [m/s]",wiki:null},ugrdmwl:{unit:"m/s",adjust:null,name:null,description:"max wind u-component of wind [m/s]",wiki:null},ugrdtrop:{unit:"m/s",adjust:null,name:null,description:"tropopause u-component of wind [m/s]",wiki:null},ulwrfsfc:{unit:"w/m^2",adjust:null,name:null,description:"surface upward long-wave rad. flux [w/m^2]",
wiki:null},ulwrftoa:{unit:"w/m^2",adjust:null,name:null,description:"top of atmosphere upward long-wave rad. flux [w/m^2]",wiki:null},uswrfsfc:{unit:"w/m^2",adjust:null,name:null,description:"surface upward short-wave rad. flux [w/m^2]",wiki:null},uswrftoa:{unit:"w/m^2",adjust:null,name:null,description:"top of atmosphere upward short-wave rad. flux [w/m^2]",wiki:null},vgrdprs:{unit:"m/s",adjust:null,name:null,description:"(1000 975 950 925 900.. 7 5 3 2 1) v-component of wind [m/s]",wiki:null},vgrd_1829m:{unit:"m/s",
adjust:null,name:null,description:"1829 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_2743m:{unit:"m/s",adjust:null,name:null,description:"2743 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_3658m:{unit:"m/s",adjust:null,name:null,description:"3658 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_305m:{unit:"m/s",adjust:null,name:null,description:"305 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_457m:{unit:"m/s",adjust:null,
name:null,description:"457 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_610m:{unit:"m/s",adjust:null,name:null,description:"610 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_914m:{unit:"m/s",adjust:null,name:null,description:"914 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd_4572m:{unit:"m/s",adjust:null,name:null,description:"4572 m above mean sea level v-component of wind [m/s]",wiki:null},vgrd10m:{unit:"m/s",adjust:null,name:"Wind, 10m, V",
description:"10 m above ground v-component of wind [m/s]",wiki:null},vgrdsig995:{unit:"m/s",adjust:null,name:null,description:"0.995 sigma level v-component of wind [m/s]",wiki:null},vgrd30_0mb:{unit:"m/s",adjust:null,name:null,description:"30-0 mb above ground v-component of wind [m/s]",wiki:null},vgrd60_30mb:{unit:"m/s",adjust:null,name:null,description:"60-30 mb above ground v-component of wind [m/s]",wiki:null},vgrd90_60mb:{unit:"m/s",adjust:null,name:null,description:"90-60 mb above ground v-component of wind [m/s]",
wiki:null},vgrd120_90mb:{unit:"m/s",adjust:null,name:null,description:"120-90 mb above ground v-component of wind [m/s]",wiki:null},vgrd150_120mb:{unit:"m/s",adjust:null,name:null,description:"150-120 mb above ground v-component of wind [m/s]",wiki:null},vgrd180_150mb:{unit:"m/s",adjust:null,name:null,description:"180-150 mb above ground v-component of wind [m/s]",wiki:null},vgrd2pv:{unit:"m/s",adjust:null,name:null,description:"pv=2e-06 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrdneg2pv:{unit:"m/s",
adjust:null,name:null,description:"pv=-2e-06 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrd0p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=5e-07 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrdneg0p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=-5e-07 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrd1pv:{unit:"m/s",adjust:null,name:null,description:"pv=1e-06 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrdneg1pv:{unit:"m/s",adjust:null,
name:null,description:"pv=-1e-06 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrd1p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=1.5e-06 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrdneg1p5pv:{unit:"m/s",adjust:null,name:null,description:"pv=-1.5e-06 (km^2/kg/s) surface v-component of wind [m/s]",wiki:null},vgrdmwl:{unit:"m/s",adjust:null,name:null,description:"max wind v-component of wind [m/s]",wiki:null},vgrdtrop:{unit:"m/s",adjust:null,name:null,description:"tropopause v-component of wind [m/s]",
wiki:null},vvelprs:{unit:"pa/s",adjust:null,name:null,description:"(1000 975 950 925 900.. 200 175 150 125 100) vertical velocity (pressure) [pa/s]",wiki:null},vvelsig995:{unit:"pa/s",adjust:null,name:null,description:"0.995 sigma level vertical velocity (pressure) [pa/s]",wiki:null},vwsh2pv:{unit:"10"+String.fromCharCode(8315)+String.fromCharCode(179)+"/s",adjust:function(a){return 1E3*a},name:null,description:"pv=2e-06 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwshneg2pv:{unit:"10"+
String.fromCharCode(8315)+String.fromCharCode(179)+"/s",adjust:function(a){return 1E3*a},name:null,description:"pv=-2e-06 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwsh0p5pv:{unit:"1/s",adjust:null,name:null,description:"pv=5e-07 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwshneg0p5pv:{unit:"1/s",adjust:null,name:null,description:"pv=-5e-07 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwsh1pv:{unit:"1/s",adjust:null,name:null,description:"pv=1e-06 (km^2/kg/s) surface vertical speed sheer [1/s]",
wiki:null},vwshneg1pv:{unit:"1/s",adjust:null,name:null,description:"pv=-1e-06 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwsh1p5pv:{unit:"1/s",adjust:null,name:null,description:"pv=1.5e-06 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwshneg1p5pv:{unit:"1/s",adjust:null,name:null,description:"pv=-1.5e-06 (km^2/kg/s) surface vertical speed sheer [1/s]",wiki:null},vwshtrop:{unit:"10"+String.fromCharCode(8315)+String.fromCharCode(179)+"/s",adjust:function(a){return 1E3*
a},name:null,description:"tropopause vertical speed sheer [1/s]",wiki:null},watrsfc:{unit:"kg/m^2",adjust:null,name:null,description:"surface water runoff [kg/m^2]",wiki:null},weasdsfc:{unit:"kg/m^2",adjust:null,name:null,description:"surface water equivalent of accumulated snow depth [kg/m^2]",wiki:null},wiltsfc:{unit:"fraction",adjust:null,name:null,description:"surface wilting point [fraction]",wiki:null}};"use strict";
SIM.Tools={momRestrictToInterval:function(a,b){return moment(Math.floor(a.valueOf()/b)*b)},minutesYear:function(){return SIM.Tools.minutesPerYear((new Date).getUTCFullYear())},minutesPerYear:function(a){return(new Date(a,11,31)-new Date(a,0,0))/6E4}};function CoordsPool(a){this.amount=a;this.sector=[];this.pool=[];this.pointer=0;this.parent=null}
CoordsPool.prototype={constructor:CoordsPool,generate:function(){var a=180/Math.PI,b;for(b=0;b<this.amount;b++){var c=-1+2*Math.random();var d=-1+2*Math.random();var e=-1+2*Math.random();var f=1/Math.sqrt(Math.pow(c,2)+Math.pow(d,2)+Math.pow(e,2));c*=f;d*=f;e*=f;f=90-Math.acos(d)*a;var g=(270+Math.atan2(c,e)*a)%360-180;this.pool.push({x:c,y:d,z:e,lat:f,lon:g})}return this},filter:function(a){var b,c=[];for(b=0;b<this.amount;b++){var d=this.pool[b];d.lat<a[0]&&d.lon>a[1]&&d.lat>a[2]&&d.lon<a[3]&&c.push(d)}return c},
slice:function(a){if(this.pointer+a>this.pool.length)return console.error("SIM.coordsPool overrun"),[];var b=new CoordsPool(a);b.pool=this.pool.slice(this.pointer,this.pointer+a);b.parent=this;return b}};"use strict";SIM.Blobs=function(a,b,c){this.vars={};this.scheme=["sMagic","dDay","iSteps","iCount"];this.loadFile(a,b,c)};
SIM.Blobs.prototype={constructor:SIM.Blobs,makeUrl:function(a){var b=DEVELOP?"?DEV":"";return"2017"===a.split("/")[0]?"/data/simulation/"+a+b:"//noiv.pythonanywhere.com/cors/simulation/"+a+b},loadFile:function(a,b,c){var d=this,e=0,f,g,k,l=new XMLHttpRequest;l.open("GET",this.makeUrl(a),!0);l.responseType="arraybuffer";l.onload=function(){f=new Uint8Array(l.response.slice(0,128));k=String.fromCharCode.apply(null,f);g=l.response.slice(128);d.parse(k,g);c(this)};l.onprogress=function(a){a.diff=a.loaded-
e;e=a.loaded;b(a)};l.send()},parse:function(a,b){var c=0;var d=0;var e=a.split(" ").filter(function(a){return a.length});for(a=0;a<this.scheme.length;a++){d=this.scheme[a].slice(0,1);var f=this.scheme[a].slice(1);this[f]="s"===d?e[a]:"i"===d?~~e[a]:"f"===d?parseFloat(e[a]):"d"===d?H.iso2Day(e[a]):console.error("Can't parse:",e)}for(a=0;a<this.Count;a++){d=e[a+4].split(":");f={name:d[0],bits:~~d[1],grid:~~d[2],steps:this.Steps,doe:~~(this.Day/864E5),shape:[this.Steps,~~d[2],~~d[2]]};var g=8===f.bits?
Int8Array:16===f.bits?Int16Array:32===f.bits?Float32Array:64===f.bits?Float64Array:console.error("Unknow ArrayType",e);d=f.steps*f.grid*f.grid*f.bits/8;f.data=new g(b.slice(c,c+d));c+=d;this.vars[f.name]=f}}};SIM.MArray=function(){this.data={};this.cache={};this.factor=this.grid=this.slice=this.doe=NaN;this.min=1E6;this.max=-1E6};
SIM.MArray.prototype={constructor:SIM.MArray,bytes:function(){var a=0;Object.keys(this.data).forEach(function(b){a+=this.data[b].length*this.data[b].BYTES_PER_ELEMENT},this);return a},sorter:function(a,b){return a<b?1:-1},first:function(){var a=Object.keys(this.data).sort(this.sorter)[0];return this.data[a]},setDateSize:function(a,b){this.doe=H.date2doe(a);this.slice=~~(a.getUTCHours()/(24/this.data[this.doe].shape[0]));this.grid=this.data[this.doe].shape[1];this.factor=(this.grid-1)/b},analyzeDoe:function(a){var b=
this.data[a],c=b.length;b.min=1E6;b.max=-1E6;for(a=0;a<c;a++){var d=b[a];b.min=d<b.min?d:b.min;b.max=d>b.max?d:b.max}this.min=b.min<this.min?b.min:this.min;this.max=b.max>this.max?b.max:this.max},getXY:function(a,b){var c=this.data[this.doe],d=c.shape[1];return c[this.slice*d*d+a+(d-b-1)*d]},interpolateXY:function(a,b){var c=this.data[this.doe],d=this.grid,e=this.slice*d*d,f=a*this.factor,g=b*this.factor;b=f-~~f;a=g-~~g;f=~~(f%d);g=~~(g%d);var k=f+1,l=g+1;return c[e+f+(d-g-1)*d]*(1-b)*(1-a)+c[e+k+
(d-g-1)*d]*b*(1-a)+c[e+f+(d-l-1)*d]*(1-b)*a+c[e+k+(d-l-1)*d]*b*a},__interpolateXY:function(a,b){var c=a*this.factor,d=b*this.factor;b=c-~~c;a=d-~~d;c=~~(c%this.grid);d=~~(d%this.grid);var e=c+1,f=d+1;return this.getXY(c,d)*(1-b)*(1-a)+this.getXY(e,d)*b*(1-a)+this.getXY(c,f)*(1-b)*a+this.getXY(e,f)*b*a}};"use strict";SIM.Datagram=function(a){this.data={};this.attributes={};this.vari="";this.parse(a)};
SIM.Datagram.prototype={constructor:SIM.Datagram,parse:function(a){a=this.parseMultiDods(a);this.info=this.analyze(a);this.vari=a.vari;this.doe=a.doe;this.data[a.doe]=a.data},append:function(a){Object.assign(this.data,a.data)},addCyclic:function(){},min:function(a){for(var b=a.length,c=Infinity;b--;)c=c<a[b]?c:a[b];return c},max:function(a){for(var b=a.length,c=-Infinity;b--;)c=c>a[b]?c:a[b];return c},analyze:function(a){return{shape:a.shape,plane:a.lats.length*a.lons.length,lats:{len:a.lats.length,
res:a.lats[1]-a.lats[0],min:this.min(a.lats),max:this.max(a.lats)},lons:{len:a.lons.length,res:a.lons[1]-a.lons[0],min:this.min(a.lons),max:this.max(a.lons)},alts:{len:a.alts.length,res:a.alts.length?a.alts[1]-a.alts[0]:NaN,min:a.alts.length?this.min(a.alts):NaN,max:a.alts.length?this.max(a.alts):NaN},tims:{len:a.tims.length,res:a.tims[1]?(a.tims[1]-a.tims[0])/36E5+"h":NaN,min:this.min(a.tims),max:this.max(a.tims)},data:{len:a.data.length,min:this.min(a.data),max:this.max(a.data),avg:a.data.reduce(function(a,
c){return a+c},0)/a.data.length}}},toDate:function(a){var b=parseInt(a,10);a=parseFloat(a);b=new Date(Date.UTC(-1,0,b-1,0,0,86400*(a-b)));a=b.getUTCFullYear();b.setUTCFullYear(a+2);return b},stripHours:function(a){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()))},flatten:function(a,b){var c=[];b=b&&a||a.slice();if(!a.length)return c;a=b.pop();do Array.isArray(a)?b.push.apply(b,a):c.push(a);while(b.length&&void 0!==(a=b.pop()));c.reverse();return c},parseMultiDods:function(a){var b=
Date.now(),c=a.split("\n").filter(function(a){return a.trim().length}),d=c[0];a=d.split(", ")[0];d=d.match(/(\[\d+)/g).join(" ").match(/(\d+)/g).map(Number);var e=c.slice(2*-d.length),f=4===d.length?2:0,g=e[1].split(", ").map(this.toDate),k=f?Float32Array.from(e[3].split(", ").map(Number)):new Float32Array(0),l=Float32Array.from(e[f+3].split(", ").map(Number));e=Float32Array.from(e[f+5].split(", ").map(Number));f=this.stripHours(g[0]);var m=H.date2doeFloat(g[0]);c=Float32Array.from(this.flatten(c.slice(1,
2*-d.length).map(function(a){return a.split(", ").slice(1)})).map(function(a){return"9.999E20"===a?NaN:parseFloat(a)}));b=Date.now()-b;return{lats:l,lons:e,tims:g,alts:k,shape:d,vari:a,date:f,doe:m,data:c,spend:b}},nearestXY:function(a,b,c){},attribute:function(a){var b;a="landsfc"===this.vari?H.firstAttr(this.data):a;if(this.attributes[a])return this.attributes[a];if(b=this.data[a]){var c=b.length;var d=new Float32Array(c);for(c=0;181>c;c++)d.set(b.subarray(360*c,360*(c+1)),360*(180-c));return this.attributes[a]=
d}console.warn("OOR",a,"have:",Object.keys(this.data));return null},clampScale:function(a,b,c,d,e){a=(e-d)*(a-b)/(c-b)+d;return a<d?d:a>e?e:a},dataTexture:function(a,b){var c=this.info.plane,d=a[0]?this.attribute(a[0]):new Float32Array(c),e=a[1]?this.attribute(a[1]):new Float32Array(c),f=a[2]?this.attribute(a[2]):new Float32Array(c);c=a[3]?this.attribute(a[3]):new Float32Array(c);var g=new Uint8Array(4*e.length);for(a=0;a<g.length;a++)g[4*a+0]=b(d[a]),g[4*a+1]=b(e[a]),g[4*a+2]=b(f[a]),g[4*a+3]=b(c[a]);
b=new THREE.DataTexture(g,360,181,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.EquirectangularReflectionMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter);b.flipY=!0;b.needsUpdate=!0;return b},linearXY:function(a,b,c){c=(c+180)%360;a=this.data[a].subarray(0*this.info.plane,1*this.info.plane);var d=this.info.lons.len,e=this.info.lats.res,f=this.info.lons.res,g=~~((c-this.info.lons.min)/f),k=~~((b-this.info.lats.min)/e),l=g+1,m=k+1;f=(c-~~c)/f;e=(b-~~b)/
e;a=a[g+k*d]*(1-f)*(1-e)+a[l+k*d]*f*(1-e)+a[g+m*d]*(1-f)*e+a[l+m*d]*f*e;isNaN(a)&&console.warn("linearXY",this.data.vari,b,c);return a},toCanvas:function(){var a,b,c=document.createElement("CANVAS"),d=document.createElement("CANVAS"),e=c.getContext("2d"),f=d.getContext("2d"),g=this.info.shape[2],k=this.info.shape[1],l=this.info.data.min,m=this.info.data.max,h=this.data.data;d.width=256;d.height=256;c.width=g;c.height=k;var q=e.getImageData(0,0,g,k);var n=q.data;for(b=a=0;a<n.length;a+=4,b++){var p=
~~H.scale(h[b],l,m,0,255);n[a]=p;n[a+1]=p;n[a+2]=p;n[a+3]=255}e.putImageData(q,0,0);SCN.monitor.drawImage(c,0,0,g,k,0,0,SCN.monitor.canvas.width,SCN.monitor.canvas.height);f.drawImage(c,0,0,g,k,0,0,256,256);return d}};
SIM.Models.tmp2m=function(){var a,b,c,d,e={obj:new THREE.Object3D,urls:[]},f="",g="",k="",l="";return a={create:function(f,g){b=f;c=g;d=b.sim.variable;e.prepare=a.prepare;e.interpolateLL=a.interpolateLL;a.calcUrls();return e},interpolateLL:function(a,b){var c=SIM.time.doe,d=c-c%.25,e=d+.25;d=SIM.datagrams.tmp2m.linearXY(d,a,b-180);a=SIM.datagrams.tmp2m.linearXY(e,a,b-180);c=(c-~~c)%.25%4;return d*(1-c)+a*c},calcUrls:function(){c.moms.forEach(function(a){b.sim.patterns.forEach(function(c){e.urls.push(b.sim.dataroot+
a.format(c))})})},clampScale:function(a,b,c,d,e){a=(e-d)*(a-b)/(c-b)+d;return a<d?d:a>e?e:a},prepareTextures:function(b){var e=[],f=1,g={},k=function(b){return a.clampScale(b,243.15,313.75,0,255)};c.does.forEach(function(a){e.push(a);4===e.length&&(g["tex"+f]={type:"t",value:b[d].dataTexture(e,k)},e=[],f+=1)});e.length&&(g["tex"+f]={type:"t",value:b[d].dataTexture(e,k)});return g},prepareFragmentShader:function(){f=H.range(1,Math.ceil(c.length/4)+1).map(function(a){return"\n  uniform sampler2D tex"+
a+";"}).join("");g=H.range(0,c.length).map(function(a){return"\n  doe < "+(.25*(a+1)).toFixed(2)+" ? texture2D( "+("tex"+(Math.floor(a/4)+1))+", vUv )."+{0:"r",1:"g",2:"b",3:"a"}[a%4]+" :"}).join("");k=H.range(0,c.length).map(function(a){return"\n  doe < "+(.25*(a+1)).toFixed(2)+" ? texture2D( "+("tex"+(Math.floor(a/4+.25)+1))+", vUv )."+{0:"g",1:"b",2:"a",3:"r"}[a%4]+" :"}).join("");Object.keys(b.sim.palette).sort(function(a,b){return parseFloat(a)-parseFloat(b)}).forEach(function(a){var c=b.sim.palette[a];
a=parseFloat(a).toFixed(1);c=c.r.toFixed(3)+", "+c.g.toFixed(3)+", "+c.b.toFixed(3);l="999.0"!==a?l+("  value < "+a+" ? vec3("+c+") : \n"):l+("    vec3("+c+")\n")})},prepare:function(){var d=Date.now(),f=SIM.time.doe,g=SIM.time.mindoe,k=b.geometry,l=a.prepareTextures(SIM.datagrams),r=a.prepareFragmentShader(),u=Object.assign(l,{doe:{type:"f",value:f-g},opacity:{type:"f",value:b.opacity},sunDirection:{type:"v3",value:SIM.sunDirection}});f=new THREE.ShaderMaterial({uniforms:u,transparent:!0,vertexShader:a.vertexShader(),
fragmentShader:a.fragmentShader(r)});k=new THREE.Mesh(k,f);e.obj.add(k);k.onBeforeRender=function(){u.sunDirection.value=SIM.sunDirection;u.sunDirection.value.y=-u.sunDirection.value.y;u.doe.value=SIM.time.doe>=c.mindoe&&SIM.time.doe<=c.maxdoe?SIM.time.doe-c.mindoe:-9999;u.doe.needsUpdate=!0;u.sunDirection.needsUpdate=!0};TIM.step("Model.tmp2m.out",Date.now()-d,"ms");return e},vertexShader:function(){return"\n        varying vec2 vUv;\n        varying vec3 vNormal;\n        void main() {\n          vUv = uv;\n          vNormal = normal;\n          gl_Position  = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      "},
fragmentShader:function(){return"\n\n        uniform float opacity;\n        uniform vec3 sunDirection;\n\n        "+f+"\n\n        varying vec2 vUv;\n        varying vec3 vNormal;\n\n        // light\n        float dotNL;\n\n        // temperatur and time\n        const  float NODATA = -9999.0;\n        vec3 color;\n        uniform float doe;\n        float frac, fac1, fac2, val1, val2, value;\n\n        // day night\n        float dnMix, dnZone;\n        float dnSharpness = 3.0;\n        float dnFactor    = 0.15;\n\n        void main() {\n\n          // compute cosine sun to normal so -1 is away from sun and +1 is toward sun.\n          dotNL = dot(normalize(vNormal), sunDirection);\n\n          // sharpen the edge beween the transition\n          dnZone = clamp( dotNL * dnSharpness, -1.0, 1.0);\n\n          // convert to 0 to 1 for mixing, 0.5 for full range\n          dnMix = 0.5 - dnZone * dnFactor;\n\n          val1 = (\n            "+
g+"\n              NODATA\n          );\n\n          val2 = (\n            "+k+"\n              NODATA\n          );\n\n          if (doe == NODATA){\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);\n          \n          } else if (val1 == NODATA) {\n            gl_FragColor = vec4(0.0, 1.0, 0.0, 0.1);\n\n          } else if (val2 == NODATA) {\n            gl_FragColor = vec4(0.0, 0.0, 1.0, 0.1);\n\n          } else {\n            frac = fract(doe);\n            fac2 = mod(frac, 0.25) * 4.0;\n            fac1 = 1.0 - fac2;\n\n            value = (val1 * fac1 + val2 * fac2) ;\n            value = -30.01 + value * 70.0 ;\n\n            color = (\n              "+
l+"\n            );\n\n            gl_FragColor = vec4(color * dnMix, opacity);\n\n            // debug\n            // gl_FragColor = vec4(dnMix, dnMix, dnMix, 0.5);\n\n          }\n          \n        }\n\n      "}}}();
SIM.Models.clouds=function(){var a,b,c,d={obj:new THREE.Object3D,objects:{},sectors:[],mindoe:NaN,maxdoe:NaN,step:function(){H.each(d.sectors,function(a,b){return b.step()})},url2doe:function(a){a=a.split("/").slice(-1)[0];return moment.utc(a,b.sim.patterns[0]).toDate()/864E5},calcUrls:function(a){var c=[];a.forEach(function(a){b.sim.patterns.forEach(function(d){c.push(b.sim.dataroot+a.format(d))})});return c}},e=new Worker("js/sim.models.clouds.worker.js"),f=new Float32Array([1,2,3,4,5,6]);e.postMessage({topic:"quadratic",
payload:f,id:Date.now()},[f.buffer]);e.onmessage=function(a){};return a={convLL:function(a,b,c){return TOOLS.latLongToVector3(a,b,CFG.earth.radius,c)},convV3:function(a,b){return TOOLS.vector3ToLatLong(a,CFG.earth.radius+b)},updateMinMax:function(){d.mindoe=Math.min.apply(Math,Object.keys(d.objects));d.maxdoe=Math.max.apply(Math,Object.keys(d.objects))},create:function(e,f){b=e;c=f;d.show=a.show;d.prepare=a.prepare;return d},show:function(a){for(var b,c;d.obj.children.length;)d.obj.remove(d.obj.children[0]);
d.objects[a]?(d.obj.add(d.objects[a]),d.objects[a].material.uniforms.factor.value=1,d.objects[a].material.uniforms.factor.needsUpdate=!0):a>d.mindoe&&a<d.maxdoe?(b=a%.25,c=b+.25,d.obj.add(d.objects[b]),d.obj.add(d.objects[c]),d.objects[b].material.uniforms.factor.value=parseFloat(a)-parseFloat(b),d.objects[c].material.uniforms.factor.value=parseFloat(c)-parseFloat(a),d.objects[b].material.uniforms.factor.needsUpdate=!0,d.objects[c].material.uniforms.factor.needsUpdate=!0,console.log("clouds.show.mix",
b,a,c)):console.warn("clouds.show.error","doe",a,d.mindoe,d.maxdoe)},prepare:function(e){TIM.step("Model.clouds.in",e);if(!c.tcdcclm.data[e])debugger;var f=Date.now(),g;var m=b.size;var h=b.amount;var q=b.radius,n=SIM.coordsPool.slice(h).pool;var p=new THREE.BufferGeometry;var r=new THREE.BufferAttribute(new Float32Array(1*h),1),u=new THREE.BufferAttribute(new Float32Array(3*h),3);for(g=h=0;h<n.length;h+=1,g+=3){var v=n[h];var B=c.tcdcclm.linearXY(e,v.lat,v.lon)/100;u.array[g+0]=v.x;u.array[g+1]=
v.y;u.array[g+2]=v.z;r.array[h+0]=B}p.addAttribute("position",u);p.addAttribute("percentage",r);m=new THREE.ShaderMaterial({uniforms:{size:{type:"f",value:m},radius:{type:"f",value:q},factor:{type:"f",value:1},seed:{type:"f",value:Math.random()},distance:{type:"f",value:SCN.camera.position.length()-CFG.earth.radius}},vertexShader:a.vertexShader(),fragmentShader:a.fragmentShader(),transparent:!0});p=new THREE.Points(p,m);p.onBeforeRender=function(a,b,c,d,e,f){e.uniforms.seed.value=Math.random();e.uniforms.seed.needsUpdate=
!0;e.uniforms.distance.value=c.position.length()-CFG.earth.radius;e.uniforms.distance.needsUpdate=!0};d.objects[e]=p;a.updateMinMax();TIM.step("Model.clouds.out",Date.now()-f,"ms");return d},vertexShader:function(){return"\n\n        attribute float percentage;\n\n        uniform float  size;\n        uniform float  radius;\n        uniform float  distance;\n\n        varying vec4  vColor;\n        varying vec3  vPos;\n\n        void main() {\n\n          vec3 pos  = position * 2.0; // radius;\n          vPos = position;\n\n          vColor = vec4(1.0, 1.0, 1.0, percentage);\n\n          gl_PointSize = size * percentage / (distance * 2.0);\n          gl_Position  = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );\n\n         }\n      \n      "},
fragmentShader:function(){return"\n\n        varying vec4 vColor;\n        varying vec3 vPos;\n\n        uniform float  factor;\n\n        float rand(vec2 co){\n            return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n        }\n\n        void main() {\n\n          if (rand(vPos.xy) > 0.5){\n            gl_FragColor = vColor;\n\n          } else {\n            discard;\n\n          }\n\n        }\n\n      "}}}();
if("function"===typeof importScripts){SIM={};importScripts("aws.helper.js","aws.tools.js");setTimeout(function(){var a=H.range(0,10,1);a=new Float32Array(a);postMessage({ta:a})},100);onmessage=function(a){var b=a.data.id;var c=a.data.topic;a=a.data.payload;topics[c]?(c=topics[c](a),postMessage({id:b,result:c})):console.warn("cloud.job: unknown topic",c)};var topics={quadratic:function(a){return new Float32Array(a.map(function(a){return a*a}))},parse:function(a){}}}
SIM.Models.jetstream=function(){var a,b,c,d={obj:new THREE.Object3D,sectors:[],urls:[],minDoe:NaN,maxDoe:NaN};return a={convLL:function(a,b,c){return TOOLS.latLongToVector3(a,b,CFG.earth.radius,c)},convV3:function(a,b){return TOOLS.vector3ToLatLong(a,CFG.earth.radius+b)},clampScale:function(a,b,c,d,l){a=(l-d)*(a-b)/(c-b)+d;return a<d?d:a>l?l:a},calcMinMax:function(a){d.minDoe=SIM.mom2doe(a[0]);d.maxDoe=SIM.mom2doe(a.slice(-1)[0])},calcUrls:function(a){a.forEach(function(a){b.sim.patterns.forEach(function(c){d.urls.push(b.sim.dataroot+
a.format(c))})})},create:function(e,f,g){b=e;4096>CFG.Device.maxVertexUniforms&&(b.amount=200);c=g;d.prepare=a.prepare;a.calcUrls(f);a.calcMinMax(f);return d},prepare:function(e){Date.now();var f,g,k,l,m,h,q,n,p,r,u,v,B,w,y,A,I,C=new THREE.Spherical,J=b.length,D=NaN,K=b.radius-CFG.earth.radius,E=SIM.coordsPool.slice(b.amount*b.sim.sectors.length),F=SCN.Meshes.Multiline.material(b);H.each(b.sim.sectors,function(O,N){A=E.filter(N).slice(0,b.amount);D=A.length;B=Array(D).fill(0).map(function(){return[]});
y=Array(D).fill(0).map(function(){return[]});w=Array(D).fill(0).map(function(){return[]});for(f=0;f<D;f++)for(q=A[f].lat,n=A[f].lon,r=a.convLL(q,n,K),g=0;g<J;g++)k=c.ugrdprs.linearXY(e,q,n),l=c.vgrdprs.linearXY(e,q,n),m=Math.hypot(k,l),I="hsl("+b.hue+", 40%, "+~~m+"%)",p=new THREE.Color(I),h=a.clampScale(m,0,50,.5,2),B[f].push(r),y[f].push(p),w[f].push(h),C.setFromVector3(r),C.theta+=3E-4*k,C.phi-=3E-4*l,r=r.setFromSpherical(C).clone(),u=a.convV3(r,K),q=u.lat,n=u.lon;v=new SCN.Meshes.Multiline.mesh(B,
y,w,F);d.obj.add(v.mesh);d.sectors.push(v)});d.obj.children[0].onAfterRender=function(){var a,c=F.uniforms.pointers.value,d=1/b.length;for(a=0;a<b.amount;a++)c[a]=(c[a]+d)%1;F.uniforms.pointers.needsUpdate=!0;F.uniforms.distance.value=SCN.camera.position.length()-CFG.earth.radius;F.uniforms.distance.needsUpdate=!0};return d}}}();
SIM.Models.variables=function(){var a,b,c,d={obj:new THREE.Object3D,calcUrls:function(a){var c=[];a.forEach(function(a){b.sim.patterns.forEach(function(d){c.push(b.sim.dataroot+a.format(d))})});return c}};return a={create:function(e,f){b=e;c=f;d.prepare=a.prepare;return d},prepare:function(e){TIM.step("Model.variables.in",e);var f=Date.now(),g=e-e%.25,k=g+.25,l=new THREE.SphereBufferGeometry(b.radius,359,180),m=new THREE.BufferAttribute(c[b.sim.variable].attribute(g),1),h=new THREE.BufferAttribute(c[b.sim.variable].attribute(k),
1),q={doe:{type:"f",value:e},opacity:{type:"f",value:b.opacity},sunPosition:{type:"v3",value:SIM.sunVector}};e=new THREE.ShaderMaterial({uniforms:q,vertexShader:a.vertexShader(),fragmentShader:a.fragmentShader(),transparent:!0,side:THREE.FrontSide,vertexColors:THREE.NoColors});e=new THREE.Mesh(l,e);void 0;l.addAttribute("doe1",m);l.addAttribute("doe2",h);d.obj.add(e);e.onAfterRender=function(){var a=SIM.time.doe;var d=c[b.sim.variable];q.doe.value=a;if(a<g||a>k)g=a-a%.25,k=g+.25,a=d.attribute(g),
d=d.attribute(k),a&&d?(l.attributes.doe1.array=a,l.attributes.doe2.array=d,l.attributes.doe1.needsUpdate=!0,l.attributes.doe2.needsUpdate=!0):(q.doe.value=0,console.log("updated",0));q.doe.needsUpdate=!0;q.sunPosition.value=SIM.sunVector;q.sunPosition.needsUpdate=!0};TIM.step("Model.variables.out",Date.now()-f,"ms");return d},vertexShader:function(){return"\n\n        attribute float doe1;\n        attribute float doe2;\n\n        varying float vData1;\n        varying float vData2;\n\n        void main() {\n\n          vData1 = doe1;\n          vData2 = doe2;\n\n          gl_Position  = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n        }\n      \n      "},
fragmentShader:function(){return"\n\n        // precision highp int;\n        // precision highp float;\n\n        uniform float doe;\n\n        varying float vData1;\n        varying float vData2;\n\n        float frac, fac1, fac2, value;\n\n        vec3 color;\n\n        void main() {\n\n          if (doe < 1.0) {\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 0.4); // error\n\n          } else {\n\n            frac = fract(doe);\n            fac2 = mod(frac, 0.25) * 4.0;\n            fac1 = 1.0 - fac2;\n\n            value = -273.15 + (vData1 * fac1 + vData2 * fac2) ;\n\n            color = (\n              value < -30.0 ? vec3(0.6666666, 0.4000000, 0.666666) : // dark violett\n              value < -20.0 ? vec3(0.8078431, 0.6078431, 0.898039) :\n              value < -10.0 ? vec3(0.4235294, 0.8078431, 0.886274) :\n              value <  +0.0 ? vec3(0.4235294, 0.9372549, 0.423529) :\n              value < +10.0 ? vec3(0.9294117, 0.9764705, 0.423529) :\n              value < +20.0 ? vec3(0.9843137, 0.7921568, 0.384313) :\n              value < +30.0 ? vec3(0.9843137, 0.3960784, 0.305882) :\n              value < +40.0 ? vec3(0.8000000, 0.2509803, 0.250980) :\n                vec3(0.6000000, 0.1509803, 0.150980)                 // dark red\n            );\n\n              gl_FragColor = vec4(color, 0.3);\n\n          }\n          \n\n        }\n\n      "}}}();
SIM.Models.wind=function(){var a,b={obj:new THREE.Object3D,sectors:[],step:function(){H.each(b.sectors,function(a,b){return b.step()})}};return a={convLL:function(a,b,e){return TOOLS.latLongToVector3(a,b,CFG.earth.radius,e)},convV3:function(a,b){return TOOLS.vector3ToLatLong(a,CFG.earth.radius+b)},clampScale:function(a,b,e,f,g){a=(g-f)*(a-b)/(e-b)+f;return a<f?f:a>g?g:a},colorTableAlpha:function(a,b){return 0===a?"rgba(170, 102, 170, "+b+")":1===a?"rgba(206, 155, 229, "+b+")":2===a?"rgba(108, 206, 226, "+
b+")":3===a?"rgba(108, 239, 108, "+b+")":4===a?"rgba(237, 249, 108, "+b+")":5===a?"rgba(251, 202,  98, "+b+")":6===a?"rgba(251, 101,  78, "+b+")":7===a?"rgba(204,  64,  64, "+b+")":"black"},latlon2color:function(b,d,e){b=b.tmp2m.linearXY(0,d,e)-273.15;b=~~a.clampScale(b,-40,30,0,7);return new THREE.Color(a.colorTableAlpha(b,1))},create:function(c,d){TIM.step("Model.wind.in");Date.now();var e,f,g,k,l,m,h,q,n,p,r,u,v,B,w,y,A=new THREE.Spherical,I=c.length,C=NaN,J=c.radius-CFG.earth.radius,D=SIM.coordsPool.slice(c.amount*
c.sim.sectors.length);H.each(c.sim.sectors,function(K,E){y=D.filter(E).slice(0,c.amount);C=y.length;v=Array(C).fill(0).map(function(){return[]});w=Array(C).fill(0).map(function(){return[]});B=Array(C).fill(0).map(function(){return[]});for(e=0;e<C;e++)for(h=y[e].lat,q=y[e].lon,p=a.convLL(h,q,J),f=0;f<I;f++)g=d.ugrd10m.linearXY(0,h,q),k=d.vgrd10m.linearXY(0,h,q),m=Math.hypot(g,k),n=a.latlon2color(d,h,q),l=a.clampScale(m,0,30,.4,1.4),v[e].push(p),w[e].push(n),B[e].push(l),A.setFromVector3(p),A.theta+=
3E-4*g,A.phi-=3E-4*k,p=p.setFromSpherical(A).clone(),r=a.convV3(p,J),h=r.lat,q=r.lon;u=new Multiline(v,w,B,c);b.obj.add(u.mesh);b.sectors.push(u)});TIM.step("Model.wind.out");return b}}}();
SIM.Models.pratesfc=function(){var a,b,c,d={obj:new THREE.Object3D,urls:[],minDoe:NaN,maxDoe:NaN};return a={create:function(e,f,g){b=e;c=g;d.prepare=a.prepare;a.calcUrls(f);a.calcMinMax(f);return d},calcMinMax:function(a){d.minDoe=SIM.mom2doe(a[0]);d.maxDoe=SIM.mom2doe(a.slice(-1)[0])},calcUrls:function(a){a.forEach(function(a){b.sim.patterns.forEach(function(c){d.urls.push(b.sim.dataroot+a.format(c))})})},prepare:function(e){TIM.step("Model.variables.in",e);var f=Date.now(),g=e-e%.25,k=g+.25,l=new THREE.SphereBufferGeometry(b.radius,
359,180),m=new THREE.BufferAttribute(c[b.sim.variable].attribute(g),1),h=new THREE.BufferAttribute(c[b.sim.variable].attribute(k),1),q=THREE.UniformsUtils.merge([{doe:{type:"f",value:e},opacity:{type:"f",value:b.opacity},sunDirection:{type:"v3",value:SIM.sunDirection}}]);e=new THREE.ShaderMaterial({uniforms:q,transparent:!0,vertexShader:a.vertexShader(),fragmentShader:a.fragmentShader()});e=new THREE.Mesh(l,e);l.addAttribute("doe1",m);l.addAttribute("doe2",h);d.obj.add(e);e.onAfterRender=function(){var a=
SIM.time.doe,e=c[b.sim.variable];q.doe.value=a;if(a>=d.minDoe&&a<=d.maxDoe){if(a<g||a>k)g=a-a%.25,k=g+.25,l.attributes.doe1.array=e.attribute(g),l.attributes.doe2.array=e.attribute(k),l.attributes.doe1.needsUpdate=!0,l.attributes.doe2.needsUpdate=!0}else q.doe.value=0;q.doe.needsUpdate=!0;q.sunDirection.value=SIM.sunDirection;q.sunDirection.needsUpdate=!0};TIM.step("Model.variables.out",Date.now()-f,"ms");return d},vertexShader:function(){return"\n\n        attribute float doe1;\n        attribute float doe2;\n\n        varying float vData1;\n        varying float vData2;\n\n        void main() {\n\n          vData1 = doe1;\n          vData2 = doe2;\n\n          gl_Position  = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n        }\n      \n      "},
fragmentShader:function(){return"\n\n        // precision highp int;\n        // precision highp float;\n\n        uniform float doe;\n\n        varying float vData1;\n        varying float vData2;\n\n        float frac, fac1, fac2, value;\n\n        vec3 color;\n\n        void main() {\n\n          vec3 irradiance;\n\n\n          if (doe < 1.0) {\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 0.4); // error\n\n          } else {\n\n            frac = fract(doe);\n            fac2 = mod(frac, 0.25) * 4.0;\n            fac1 = 1.0 - fac2;\n\n            value = (vData1 * fac1 + vData2 * fac2) ;\n\n            if ( value <= 0.00005 ) {\n              discard;\n\n            } else {\n              color = (\n                value < 0.0001 ? vec3(0.666, 0.400, 0.666) : // dark violett\n                value < 0.0002 ? vec3(0.807, 0.607, 0.898) :\n                value < 0.0003 ? vec3(0.423, 0.807, 0.886) :\n                value < 0.0004 ? vec3(0.423, 0.937, 0.423) :\n                value < 0.0005 ? vec3(0.929, 0.976, 0.423) :\n                value < 0.0006 ? vec3(0.984, 0.792, 0.384) :\n                value < 0.0007 ? vec3(0.984, 0.396, 0.305) :\n                value < 0.0008 ? vec3(0.800, 0.250, 0.250) :\n                  vec3(0.600, 0.150, 0.150)                  // dark red\n              );\n\n              gl_FragColor = vec4(color, 0.3); //0.3 good\n\n            }\n\n          }\n          \n        }\n\n      "}}}();
var SCN=function(){var a,b=0,c=NaN,d=document.querySelectorAll.bind(document)(".simulator")[0],e=new THREE.Vector3(0,0,0),f=new THREE.WebGLRenderer({canvas:d,antialias:!0,preserveDrawingBuffer:!0}),g,k=new THREE.Scene,l=1,m={},h={};return a={home:e,scene:k,camera:g,objects:h,renderer:f,toggleRender:function(a){},add:function(a,b){h[a]=b;h[a].name=a;k.add(b)},setComb:function(a){l=a},toggle:function(a,b){if(k.getObjectByName(a.name)||!1===b)k.remove(a);else if(a instanceof THREE.Object3D)k.add(a);
else SCN.Tools.loader[a.type](a.name,a,function(){});IFC.urlDirty=!0},isActive:function(a){var b=!1;H.each(h,function(c,d){!b&&c===a&&d instanceof THREE.Object3D&&(b=!0)});return b},toggleBasemap:function(b){var c;"string"===typeof b?c=b:console.error("SCN.toggleBasemap","illegal basemap param");H.each(h,function(b,d){void 0!==CFG.Objects[b]&&(b===c?a.toggle(d,!0):-1!==CFG.BasemapIds.indexOf(CFG.Objects[b].id)&&a.toggle(d,!1))});ANI.insert(0,ANI.library.lightset(CFG.Lightsets[CFG.Objects[c].lightset],
300));console.log("SCN.toggleBasemap",c)},resize:function(a){f.setSize(a.width,a.height);g&&(g.aspect=a.aspect,g.updateProjectionMatrix())},init:function(){f.setClearColor(6693376,1);f.shadowMap.enabled=!1;f.autoClear=!1;g=a.camera=CFG.Camera.cam;g.position.copy(CFG.Camera.pos);a.add("camera",g)},reset:{controller:function(){IFC.Controller.reset()}},actions:function(b,c,d){var e=function(){};e={Loading:{update:e},SimTime:{update:e},Render:{toggle:function(a){return a}},ResetCam:{toggle:function(a){return doSimulate=
a}},Ambient:{toggle:function(b){return a.toggle(h.ambient,b)},intensity:function(a){return h.ambient.intensity=a},color:function(a){return h.ambient.color=new THREE.Color(a)}},Spot:{toggle:function(b){return a.toggle(h.spot,b)},angle:function(a){return h.spot.angle=a},intensity:function(a){return h.spot.intensity=a},color:function(a){return h.spot.color=new THREE.Color(a)}},Sun:{toggle:function(b){return a.toggle(h.sun,b)},intensity:function(a){return h.sun.intensity=a},skycolor:function(a){return h.sun.color=
new THREE.Color(a)},grdcolor:function(a){return h.sun.groundColor=new THREE.Color(a)}},Atmosphere:{toggle:function(b){return a.toggle(h.atmosphere,b)},opacity:function(a){return h.atmosphere.update({opacity:a})}},Assets:function(){var b={};H.each(CFG.Objects,function(c,d){d.id&&(b[c.toUpperCase()]=function(b){return a.toggle(h[c],b)})});return b}(),Camera:{reset:function(b){return a.reset.controller()}},DateTime:{choose:function(a){return SIM.setSimTime(a)},"hour  +1":function(a){return SIM.setSimTime(1,
"hours")},"hour  -1":function(a){return SIM.setSimTime(-1,"hours")},"hour  +6":function(a){return SIM.setSimTime(6,"hours")},"hour  -6":function(a){return SIM.setSimTime(-6,"hours")},"hour +24":function(a){return SIM.setSimTime(24,"hours")},"hour -24":function(a){return SIM.setSimTime(-24,"hours")},"day  +30":function(a){return SIM.setSimTime(30,"days")},"day  -30":function(a){return SIM.setSimTime(-30,"days")}},Animations:{Rotate:function(a){return ANI.insert(0,ANI.library.datetime.add(1,"days",
800))}}};try{e[b][c](d)}catch(u){console.warn("SCN.actions.error",b,c,d),console.log(u)}},prerender:function(){var a=Date.now();f.clear();f.render(k,g);f.render(k,g);f.clearDepth();IFC.Hud.render(f);IFC.Hud.render(f);TIM.step("SCN.prerender",Date.now()-a,"ms")},render:function n(){var a=performance.now(),d=(a-(c||a))/1E3;requestAnimationFrame(n);!l||b%l||(IFC.Hud.performance.begin(),TWEEN.update(),IFC.step(b,d),g.radius=g.position.length(),g.distance=g.radius-CFG.earth.radius,h.background.updatePosition(),
SIM.updateSun(),h.spot.position.copy(SIM.sunPosition),h.sun.position.copy(SIM.sunPosition),ANI.step(b,d),f.clear(),f.render(k,g),IFC.Hud.step(b,d),IFC.Hud.render(f),IFC.Hud.performance.end(),IFC.Hud.performance.render());c=a;b+=1},probeDevice:function(){var a=f.context,b=CFG.Device;a.getSupportedExtensions().forEach(function(a){return m[a]=a});b.devicePixelRatio=devicePixelRatio;b.maxVertexUniforms=f.capabilities.maxVertexUniforms;b.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);b.max_texture_image_units=
a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);b.max_cube_map_texture_size=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);b.OES_texture_float=!!m.OES_texture_float;b.OES_texture_float_linear=!!m.OES_texture_float_linear},logFullInfo:function(){var a=f.context;console.log("SAMPLES",a.getParameter(a.SAMPLES));console.log("MAX_RENDERBUFFER_SIZE",a.getParameter(a.MAX_RENDERBUFFER_SIZE));console.log("MAX_VERTEX_UNIFORM_VECTORS ",a.getParameter("MAX_VERTEX_UNIFORM_VECTORS",a.MAX_VERTEX_UNIFORM_VECTORS));console.log("MAX_FRAGMENT_UNIFORM_VECTORS",
a.getParameter("MAX_FRAGMENT_UNIFORM_VECTORS",a.MAX_FRAGMENT_UNIFORM_VECTORS));console.log("renderer",JSON.stringify({children:k.children.length,geometries:f.info.memory.geometries,calls:f.info.render.calls,textures:f.info.memory.textures,faces:f.info.render.faces,vertices:f.info.render.vertices,maxAttributes:f.capabilities.maxAttributes,maxTextures:f.capabilities.maxTextures,maxVaryings:f.capabilities.maxVaryings,maxVertexUniforms:f.capabilities.maxVertexUniforms,floatFragmentTextures:f.capabilities.floatFragmentTextures,
floatVertexTextures:f.capabilities.floatVertexTextures,getMaxAnisotropy:f.capabilities.getMaxAnisotropy,extensions:a.getSupportedExtensions()},null,2))}}}();
SCN.Tools={loadCube:function(a,b,c){var d,e,f,g=new THREE.BoxGeometry(1,1,1,16,16,16),k=CFG.Faces.map(function(a){if("globe"===b.cube.type)return H.replace(b.cube.texture,"FACE",a);if("polar"===b.cube.type)return"top"===a||"bottom"===a?H.replace(b.cube.texture,"FACE",a):"images/transparent.face.512.png"});for(d in g.vertices){var l=g.vertices[d];l.normalize().multiplyScalar(b.cube.radius)}g.computeVertexNormals();RES.load({urls:k,type:"texture",onFinish:function(d,k){d&&console.log(d);e=k.map(function(a){return new THREE.MeshPhongMaterial(Object.assign({map:a.data,
shininess:0,alphaTest:.5}),b.material)});f=new THREE.Mesh(g,e);b.rotation&&f.rotation.fromArray(b.rotation);c(a,f)}})},loader:{mesh:function(a,b,c){SCN.add(a,b.mesh);c()},light:function(a,b,c){b.light=b.light(b);b.pos&&b.light.position.copy(b.pos);SCN.add(a,b.light);c()},"mesh.calculated":function(a,b,c){SCN.add(a,SCN.Meshes.calculate(a,b));c()},"mesh.module":function(a,b,c){SCN.Meshes[a](a,b,function(a,b){SCN.add(a,b);c()})},simulation:function(a,b,c){SIM.loadVariable(a,b,function(a,e){b.rotation&&
e.rotation.fromArray(b.rotation);SCN.add(a,e);c()})},"geo.json":function(a,b,c){RES.load({type:"text",urls:[b.json],onFinish:function(d,e){d=new THREE.Object3D;e=JSON.parse(e[0].data);drawThreeGeo(e,b.radius,"sphere",{color:b.color,lights:!0},d);b.rotation&&d.rotation.fromArray(b.rotation);SCN.add(a,d);c()}})},"cube.textured":function(a,b,c){SCN.Tools.loadCube(a,b,function(a,b){SCN.add(a,b);c()})}}};
SCN.Meshes={calculate:function(a,b){return SCN.Meshes[a](b)},sector:function(a,b){function c(b){var c,k=0,h=b[0],q=b[1],n=b[2],p=b[3];b=(Math.abs(p-q)+1)*d;var r=(Math.abs(n-h)+1)*d;q=TOOLS.flatten([H.linspace(q,p,b),H.linspace(p,p,r-2),H.linspace(p,q,b),H.linspace(q,q,r-2),[q]]);h=TOOLS.flatten([H.linspace(h,h,b),H.linspace(h,n,r-2),H.linspace(n,n,b),H.linspace(n,h,r-2),[h]]);H.zip(h,q,function(b,d){c=TOOLS.latLongToVector3(b,d,CFG.earth.radius,a.altitude);f[k+0]=c.x;f[k+1]=c.y;f[k+2]=c.z;g[k+0]=
.9;g[k+1]=.9;g[k+2]=.3;k+=3});e.setDrawRange(0,h.length);e.attributes.position.needsUpdate=!0;e.attributes.color.needsUpdate=!0;e.computeBoundingSphere()}var d=a.resolution,e=new THREE.BufferGeometry;b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});b=new THREE.Line(e,b);var f=new Float32Array(3E3),g=new Float32Array(3E3);e.addAttribute("position",new THREE.BufferAttribute(f,3));e.addAttribute("color",new THREE.BufferAttribute(g,3));c(a.sector);b.updateSector=c;return b},graticule:function(a,
b){var c=H.linspace(-180,180,37),d=H.linspace(-90,90,19);b=new THREE.Object3D;var e=new THREE.Geometry,f=new THREE.LineBasicMaterial(Object.assign({},a.material,{}));f=new THREE.LineSegments(e,f);var g=new THREE.LineBasicMaterial({color:16777215}),k=new THREE.Geometry;g=new THREE.Line(k,g);var l=new THREE.LineBasicMaterial({color:16776960}),m=new THREE.Geometry;l=new THREE.Line(m,l);var h=new THREE.Vector3,q=new THREE.LineBasicMaterial({color:16711680}),n=new THREE.Geometry;q=new THREE.Line(n,q);
var p=function(b,c){return TOOLS.latLongToVector3(b,c,CFG.earth.radius,a.altitude)};H.each(c.slice(0,-1),function(a,b){H.each(d.slice(0,-1),function(f,g){var k=c[~~a+1],l=d[~~f+1];f=p(b,g);l=p(b,l);var h=p(b,g);g=p(k,g);e.vertices.push(f,l,h,g)})});k.vertices.push(new THREE.Vector3(0,1.5,0),new THREE.Vector3(0,-1.5,0));m.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(2,2,2));n.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0));b.add(q,l,g,f);f.onBeforeRender=function(){h.copy(IFC.pointer.intersect).normalize().multiplyScalar(1.2);
m.vertices[1]=h;m.verticesNeedUpdate=!0;n.vertices[1]=SIM.sunPosition;n.verticesNeedUpdate=!0};return b}};
SCN.Meshes.Multiline={mesh:function(a,b,c,d){var e=this,f=0;this.bytes=NaN;this.amount=a.length;this.length=a[0].length;this.points=this.amount*this.length;this.geometry=new THREE.BufferGeometry;this.attributes={lineIndex:Float32Array,colors:Float32Array,next:Float32Array,position:Float32Array,previous:Float32Array,side:Float32Array,uv:Float32Array,width:Float32Array,index:Uint16Array};this.lines=H.zip(a,b,c,function(a,b,c){return new SCN.Meshes.Multiline.line(f++,a,b,c)});H.each(this.attributes,
function(a,b){var c=0,d=0,f=e.lines[0].attributes[a].itemSize,g=e.lines[0].attributes.position.count;e.attributes[a]=new THREE.BufferAttribute(new b(e.lines[0].attributes[a].array.length*e.amount),f);var k=e.attributes[a].array;H.each(e.lines,function(b,e){e=e.attributes[a].array;var f=e.length;if("index"===a)for(b=0;b<f;b++)k[c+b]=e[b]+d;else for(b=0;b<f;b++)k[c+b]=e[b];c+=f;d+=g});"index"===a?e.geometry.setIndex(e.attributes.index):e.geometry.addAttribute(a,e.attributes[a])});this.geometry.computeBoundingSphere();
this.mesh=new THREE.Mesh(this.geometry,d);this.bytes=Object.keys(this.attributes).map(function(a){return e.attributes[a].array.length}).reduce(function(a,b){return a+b},0)},material:function(a){var b=Array(a.amount).fill(0).map(function(){return Math.random()*a.length}),c=SCN.camera.position.length()-CFG.earth.radius;return new THREE.RawShaderMaterial({vertexShader:SCN.Meshes.Multiline.shaderVertex(a.amount),fragmentShader:SCN.Meshes.Multiline.shaderFragment(),depthTest:!0,depthWrite:!1,blending:THREE.AdditiveBlending,
side:THREE.DoubleSide,transparent:!0,lights:!1,shading:THREE.SmoothShading,vertexColors:THREE.NoColors,wireframe:!1,uniforms:{color:{type:"c",value:a.color},opacity:{type:"f",value:a.opacity},lineWidth:{type:"f",value:a.lineWidth},section:{type:"f",value:a.section},pointers:{type:"1fv",value:b},distance:{type:"f",value:c}}})},shaderVertex:function(a){return"\n\n    // precision highp float;\n\n    attribute float side;\n    attribute vec2  uv;\n    attribute vec3  next;\n    attribute vec3  position;\n    attribute vec3  previous;\n\n    attribute float width;\n    attribute vec3  colors;\n    attribute float lineIndex;\n\n    uniform mat4  projectionMatrix;\n    uniform mat4  modelViewMatrix;\n\n    uniform float distance;\n    uniform float lineWidth;\n    uniform vec3  color;\n    uniform float opacity;\n\n    uniform float pointers[  "+
a+"  ];  // start for each line\n    \n    varying vec2  vUV;\n    varying vec4  vColor;\n    varying float vHead;\n    varying float vCounter;\n\n    vec2 dir;\n    vec2 dir1;\n    vec2 dir2;\n    vec2 normal;\n    vec4 offset;\n\n    void main() {\n\n\n        // vUV       = uv;\n        vHead     = pointers[int(lineIndex)];   // get head for this segment\n        vCounter  = fract(lineIndex);           // get pos of this segment \n        vColor    = vec4( colors, opacity );\n\n        mat4 m = projectionMatrix * modelViewMatrix;\n\n        vec4 finalPosition = m * vec4( position, 1.0 );\n        vec4 prevPos       = m * vec4( previous, 1.0 );\n        vec4 nextPos       = m * vec4( next, 1.0 );\n\n        vec2 currP = finalPosition.xy / finalPosition.w;\n        vec2 prevP = prevPos.xy       / prevPos.w;\n        vec2 nextP = nextPos.xy       / nextPos.w;\n\n        if      ( nextP == currP ) { dir = normalize( currP - prevP) ;}\n        else if ( prevP == currP ) { dir = normalize( nextP - currP) ;}\n        else {\n            dir1 = normalize( currP - prevP );\n            dir2 = normalize( nextP - currP );\n            dir  = normalize( dir1  + dir2 );\n        }\n\n        normal  = vec2( -dir.y, dir.x );\n        normal *= lineWidth * width * distance;\n\n        offset = vec4( normal * side, 0.0, 1.0 );\n        finalPosition.xy += offset.xy;\n\n        gl_Position = finalPosition;\n\n    }"},
shaderFragment:function(){return"\n\n    precision mediump float;\n\n    float alpha  = 0.0;\n\n    uniform float section;   // visible segment length\n\n    varying vec4  vColor;    // color from attribute, includes uni opacity\n    varying float vHead;     // head of line segment\n    varying float vCounter;  // current position, goes from 0 to 1 \n\n    void main() {\n\n      vec4  color = vColor;\n      float head  = vHead;\n      float tail  = max(0.0, vHead - section);\n      float pos   = vCounter;\n\n      if ( pos > tail && pos < head ) {\n        alpha = (pos - tail) / section;\n\n      } else if ( pos > ( 1.0 - section ) && head < section ) {\n        alpha = ( pos - section - head ) / section; \n\n      } else {\n        discard;\n\n      }\n\n      gl_FragColor = vec4( color.rgb, alpha * color.a );\n\n    }"}};
SCN.Meshes.Multiline.line=function(a,b,c,d){this.idx=a;this.indices=[];this.lineIndex=[];this.next=[];this.positions=[];this.previous=[];this.side=[];this.uvs=[];this.widths=[];this.colors=[];this.length=b.length;this.init(b,c,d);this.process();this.attributes={index:new THREE.BufferAttribute(new Uint16Array(this.indices),1),lineIndex:new THREE.BufferAttribute(new Float32Array(this.lineIndex),1),next:new THREE.BufferAttribute(new Float32Array(this.next),3),position:new THREE.BufferAttribute(new Float32Array(this.positions),
3),previous:new THREE.BufferAttribute(new Float32Array(this.previous),3),side:new THREE.BufferAttribute(new Float32Array(this.side),1),uv:new THREE.BufferAttribute(new Float32Array(this.uvs),2),width:new THREE.BufferAttribute(new Float32Array(this.widths),1),colors:new THREE.BufferAttribute(new Float32Array(this.colors),3)}};
SCN.Meshes.Multiline.line.prototype={constructor:SCN.Meshes.Multiline.line,compareV3:function(a,b){a*=6;b*=6;return this.positions[a]===this.positions[b]&&this.positions[a+1]===this.positions[b+1]&&this.positions[a+2]===this.positions[b+2]},copyV3:function(a){a*=6;return[this.positions[a],this.positions[a+1],this.positions[a+2]]},init:function(a,b,c){var d,e=this.length;for(d=0;d<e;d++){var f=a[d];var g=b[d];var k=c[d];var l=d/a.length;this.positions.push(f.x,f.y,f.z);this.positions.push(f.x,f.y,
f.z);this.lineIndex.push(this.idx+l);this.lineIndex.push(this.idx+l);this.colors.push(g.r,g.g,g.b);this.colors.push(g.r,g.g,g.b);this.widths.push(k);this.widths.push(k);this.side.push(1);this.side.push(-1);this.uvs.push(d/(e-1),0);this.uvs.push(d/(e-1),1)}for(d=0;d<e-1;d++)a=d+d,this.indices.push(a,a+1,a+2),this.indices.push(a+2,a+1,a+3)},process:function(){var a,b=this.positions.length/6;var c=this.compareV3(0,b-1)?this.copyV3(b-2):this.copyV3(0);this.previous.push(c[0],c[1],c[2]);this.previous.push(c[0],
c[1],c[2]);for(a=0;a<b-1;a++)c=this.copyV3(a),this.previous.push(c[0],c[1],c[2]),this.previous.push(c[0],c[1],c[2]);for(a=1;a<b;a++)c=this.copyV3(a),this.next.push(c[0],c[1],c[2]),this.next.push(c[0],c[1],c[2]);c=this.compareV3(b-1,0)?this.copyV3(1):this.copyV3(b-1);this.next.push(c[0],c[1],c[2]);this.next.push(c[0],c[1],c[2])}};"use strict";
SCN.Meshes.atmosphere=function(a,b,c){var d=new THREE.SphereGeometry(b.radius,128,128),e={sunPosition:{type:"v3",value:SIM.sunVector},opacity:{type:"f",value:b.opacity}};d=new THREE.Mesh(d,new THREE.ShaderMaterial({vertexShader:"\n\n      varying vec3 vNormal, vPosition;\n      \n      void main() {\n\n        vNormal   = normal;\n        vPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n\n        gl_Position  = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n      }\n    ",fragmentShader:"\n\n      uniform float opacity;\n      uniform vec3  sunPosition;\n      uniform mat4  modelMatrix;       // = object.matrixWorld\n      uniform mat3  normalMatrix;      // = inverse transpose of modelViewMatrix\n\n      varying vec3  vNormal, vPosition;\n\n      float fresnel, atmoFactor, reflecting, dotLight;\n\n      vec3 worldNormal, worldView;\n      vec3 color, colorDay, colorDark, colorSunset, colorNight;\n\n      void main() {\n        \n        worldNormal = normalize ( normalMatrix * vNormal );                            \n        worldView   = normalize ( cameraPosition -  (modelMatrix * vec4(vPosition, 1.0)).xyz );\n\n        // dot world space normal with world space sun vector\n        dotLight    = dot(worldNormal, sunPosition);\n\n        // fresnel factor\n        fresnel     = 1.0 - max(dot(worldNormal, worldView), 0.0);\n        reflecting  = max(0.0, dot(reflect(worldView, worldNormal), sunPosition));\n\n        atmoFactor  = max(0.0, pow(fresnel * 1.5, 1.5)) - max(0.0, pow(fresnel, 15.0)) * 6.0;\n\n        colorDay    = vec3( 0.3,  0.7,  1.0);\n        colorDark   = vec3( 0.0,  0.0,  0.5);\n        colorSunset = vec3( 1.0,  0.3,  0.1);\n        colorNight  = vec3( 0.05, 0.05, 0.1);\n        \n        colorDark   = mix(\n          colorDark, \n          colorSunset + colorSunset * reflecting * 2.0, \n          pow(reflecting, 16.0) * max(0.0, dotLight + 0.7)\n        );\n        \n        // colorDark = vec3(1.0, 0.0, 0.0);\n\n        color  = mix(colorDay, colorDark,  min(1.0, (dotLight / 2.0 + 0.6) * 1.7));\n        color  = mix(color,    colorNight, min(1.0, (dotLight / 2.0 + 0.4) * 1.5));\n        color *= atmoFactor;\n        \n        gl_FragColor = vec4(color, opacity);\n\n      }\n    ",
transparent:!0,uniforms:e}));d.onBeforeRender=function(){e.sunPosition.value=SIM.sunVector;e.sunPosition.needsUpdate=!0};b.rotation&&d.rotation.fromArray(b.rotation);c(a,d)};
SCN.Meshes.background=function(a,b,c){var d=new THREE.PlaneBufferGeometry(1,1,1,1),e=new THREE.ShaderMaterial({fragmentShader:"\n\n      // Note that for mobiles you'll probably want to replace this by mediump since highp might be slower.\n\n      // precision highp int;\n      // precision highp float;\n\n      varying vec3 vColor;  \n\n      uniform float opacity;\n\n      void main() {\n        gl_FragColor = vec4(vColor, opacity);\n      }\n    ",vertexShader:"\n\n      attribute vec3 colors;\n\n      varying   vec2 vUv;  \n      varying   vec3 vColor;  \n\n      void main() {\n        vUv         = uv;\n        vColor      = colors;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      }\n    ",
uniforms:{opacity:{type:"f",value:.999}}}),f=new THREE.Mesh(d,e);e=function(a){var b=0,c=d.attributes.colors.array,e=new THREE.Color;a.forEach(function(a){e.set(a);c[b++]=e.r;c[b++]=e.g;c[b++]=e.b});d.attributes.colors.needsUpdate=!0};d.addAttribute("colors",new THREE.BufferAttribute(new Float32Array(12),3));e(b.colors);f.updateColors=e;f.updatePosition=function(){var a=SCN.camera,b=2*Math.tan(a.fov*PI/180/2)*a.radius+2,c=b*IFC.geometry.aspect,d=1/SCN.scene.scale.x;f.position.copy(a.position.clone().negate().normalize().multiplyScalar(2));
f.lookAt(a.position);f.scale.set(c*d,b*d,1)};c(a,f)};"use strict";
SCN.Meshes.basemaps=function(a,b,c){var d,e,f,g=new THREE.BoxGeometry(1,1,1,16,16,16),k=CFG.Faces.map(function(a){if("globe"===b.cube.type)return H.replace(b.cube.texture,"FACE",a);if("polar"===b.cube.type)return"top"===a||"bottom"===a?H.replace(b.cube.texture,"FACE",a):"images/transparent.face.512.png"});for(d in g.vertices){var l=g.vertices[d];l.normalize().multiplyScalar(b.cube.radius)}g.computeVertexNormals();RES.load({urls:k,type:"texture",onFinish:function(d,k){e=k.map(function(a){return new THREE.MeshLambertMaterial(Object.assign({map:a.data,
alphaTest:.99}),b.material)});f=new THREE.Mesh(g,e);b.rotation&&f.rotation.fromArray(b.rotation);c(a,f)}})};"use strict";
SCN.Meshes.basecopy=function(a,b,c){var d,e,f,g=new THREE.BoxGeometry(1,1,1,16,16,16),k=CFG.Faces.map(function(a){if("globe"===b.cube.type)return H.replace(b.cube.texture,"FACE",a);if("polar"===b.cube.type)return"top"===a||"bottom"===a?H.replace(b.cube.texture,"FACE",a):"images/transparent.face.512.png"});for(d in g.vertices){var l=g.vertices[d];l.normalize().multiplyScalar(b.cube.radius)}g.computeVertexNormals();RES.load({urls:k,type:"texture",onFinish:function(d,k){e=k.map(function(a){return new THREE.MeshPhongMaterial(Object.assign({map:a.data,
alphaTest:.99}),b.material)});f=new THREE.Mesh(g,new THREE.MultiMaterial(e));b.rotation&&f.rotation.fromArray(b.rotation);c(a,f)}})};"use strict";
SCN.Meshes.pixels=function(a,b,c){var d=new THREE.PlaneGeometry(2,2,1,1);b={time:{type:"f",value:.5},texture:{type:"t",value:CFG.Textures[b.texture]},distance:{type:"f",value:SCN.camera.position.length()},resolution:{type:"v2",value:new THREE.Vector2(window.innerWidth,window.innerHeight)},campos:{type:"v3",value:SCN.camera.position}};var e=new THREE.ShaderMaterial({fragmentShader:"\n\n      uniform float time, distance;\n      uniform vec2 resolution;\n      uniform sampler2D texture;\n      uniform vec3 campos;\n\n      uniform mat4 projectionMatrix;\n      // uniform mat4 viewMatrix;\n      \n      vec2 p, uv, coords;\n\n      float factor, radius, aspect;\n\n      void main(void) {\n\n        aspect = resolution.x / resolution.y;\n\n        // SHADERTOY: vec2 p = (2.0 * fragCoord.xy - iResolution.xy ) / iResolution.y;\n        // ORG:       vec2 p = -1.0 + 2.0 * gl_FragCoord.xy / resolution.xy;\n\n        p   = -1.0 + 2.0 * gl_FragCoord.xy / resolution.xy;   // */ => offset diagonal\n        p.y = p.y / aspect;\n\n        radius = sqrt(dot( p, p )) * aspect * distance / 2.6;      // sqrt: works with distance\n\n        // radius close //\n\n\n        factor = (1.0 - sqrt(1.0 - radius)) / ( radius ) * distance * aspect / 11.0;\n\n        uv.x = 0.5 + p.x * factor;\n        uv.y = 0.5 + p.y * factor * 2.0;\n\n        // uv = ( viewMatrix * vec4(uv, 1.0, 1.0) ).xy;\n\n        if (radius < 1.0) {\n          gl_FragColor = vec4(texture2D(texture, uv).xyz, 0.5);\n\n        } else {\n          gl_FragColor = vec4(1.0, 0.5, 0.0, 0.2);\n\n        }\n      \n      }\n    ",vertexShader:"\n\n      uniform vec2 resolution;\n\n      float aspect;\n      vec3 pos;\n\n      void main(void) {\n\n        // aspect = resolution.x / resolution.y;\n\n        // pos.x = position.x; \n        // pos.y = position.y * aspect * 2.0;\n\n        // gl_Position = vec4(pos * 0.7, 1.0); \n\n        gl_Position = vec4(position * 0.98, 1.0); \n\n      }\n    ",
uniforms:b,side:THREE.DoubleSide,transparent:!0,opacity:.5});d=new THREE.Mesh(d,e);d.onBeforeRender=function(){e.uniforms.time.value+=.005;e.uniforms.campos.value=SCN.camera.position;e.uniforms.distance.value=SCN.camera.position.length();e.uniforms.resolution.value.set(window.innerWidth,window.innerHeight);e.uniforms.time.needsUpdate=!0;e.uniforms.campos.needsUpdate=!0;e.uniforms.distance.needsUpdate=!0;e.uniforms.resolution.needsUpdate=!0};c(a,d)};
SCN.Meshes.population=function(a,b,c){var d=CITIES.length,e=new Float32Array(3*d),f=new Float32Array(1*d),g=new THREE.BufferGeometry;var k=new THREE.ShaderMaterial({vertexShader:"\n\n      attribute float size;\n\n      uniform float radius;\n\n      void main() {\n        gl_PointSize    = radius * size;\n        gl_Position     = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      }\n\n    ",fragmentShader:"\n\n      uniform sampler2D map;\n      uniform vec3 ucolor;\n      uniform float opacity;\n\n      void main() {\n\n        vec4 color1 = texture2D( map, gl_PointCoord ).rgba;\n\n        if (color1.a <= 0.5 ) {\n          discard;\n        \n        } else {\n          vec3 color2   = mix(ucolor, color1.rgb, 0.5);\n          gl_FragColor  = vec4( color2, opacity);\n\n        }\n\n      }\n\n    ",
transparent:!1,blending:THREE.AdditiveBlending,uniforms:{map:{type:"t",value:CFG.Textures["dot.white.128.png"]},opacity:{type:"f",value:b.opacity},radius:{type:"f",value:b.radius},ucolor:{type:"c",value:b.color}}});var l=new THREE.Points(g,k);for(k=0;k<d;k++){var m=CITIES[k];var h=TOOLS.latLongToVector3(m.lat,m.lon,CFG.earth.radius,b.altitude);e[3*k+0]=h.x;e[3*k+1]=h.y;e[3*k+2]=h.z;m=158*(m.pop-1E6)/159E6+2;f[k]=~~(2>m?2:160<m?160:m)}g.addAttribute("size",new THREE.BufferAttribute(f,1));g.addAttribute("position",
new THREE.BufferAttribute(e,3));g.computeBoundingSphere();c(a,l)};
var IFC=function(){var a,b=document.querySelectorAll.bind(document),c=b(".simulator")[0],d=b(".fullscreen")[0],e,f,g=!1,k,l=[],m="space",h={height:NaN,width:NaN,aspect:NaN,diagonal:NaN,distance:NaN,radius:NaN},q={x:NaN,y:NaN,px:NaN,py:NaN,down:!1,button:NaN,wheel:{x:0,y:0}},n={x:NaN,y:NaN,px:NaN,py:NaN,down:!1},p={device:q,overGlobe:!1,overScreen:!1,intersect:new THREE.Vector3(0,0,0),latitude:NaN,longitude:NaN},r=new THREE.Raycaster;return a={modus:m,pointer:p,geometry:h,controller:k,urlDirty:!1,
init:function(){a.events.resize();a.urlDirty=!1;e=b("div.dg.ac")[0];f=b("div.dg.main.a")[0];d.appendChild(e);f.style.margin="0";f.style.top="72px";f.style.right="0";f.style.width="";f.style.position="absolute";r.params.Points.threshold=.001;k=a.controller=IFC.Controller;k.init(SCN.camera,SCN.renderer.domElement,{minDistance:CFG.Camera.minDistance,maxDistance:CFG.Camera.maxDistance,onorient:function(a){a(0,0,0)},ondrag:function(a,b,c,d){H.scale(p.device.py,0,h.height,.5,10);"space"===m?p.overGlobe?
a(b,c,d):(SIM.setSimTime(b,"hours"),a(0,0,0)):(SIM.setSimTime(b,"hours"),a(0,0,0))},onwheel:function(a,b,c,d){var e=H.scale(p.device.py,0,h.height,.5,20);p.overGlobe?a(b,c,d):(SIM.setSimTime(~~(-5*b*e),"minutes"),a(0,0,0))},onRelax:function(){a.urlDirty=!0}});IFC.Hud.init()},toggleGUI:function(){g=!g;e.style.display=g?"block":"none";window.GUI.closed=!g},show:function(){b("canvas.simulator")[0].style.display="block";IFC.Hud.time.render();IFC.Tools.updateUrl();a.urlDirty=!1},activate:function(){IFC.Hud.activate();
H.each([[c,"mousedown"],[c,"mouseup"],[c,"mousemove"],[c,"mouseenter"],[c,"mouseover"],[document,"mouseleave"],[document,"mouseout"],[c,"click"],[c,"touchstart"],[c,"touchmove"],[c,"touchend"],[c,"touchcancel"],[document,"contextmenu"],[document,"keydown"],[window,"orientationchange"],[window,"resize"]],function(b,c){return c[0].addEventListener(c[1],a.events[c[1]],!1)});k.activate()},step:function(b,c){k.step(b,c);a.updatePointer();a.updateGlobe();a.updateLatLon();a.urlDirty&&(IFC.Tools.updateUrl(),
a.urlDirty=!1)},events:{onglobeenter:function(){ANI.insert(0,ANI.library.scaleGLobe(1,800));IFC.Hud.spacetime.updateModus("space");IFC.Hud.performance.selectModus(1)},onglobeleave:function(){ANI.insert(0,ANI.library.scaleGLobe(.94,800));IFC.Hud.spacetime.updateModus("time");IFC.Hud.performance.selectModus(2)},resize:function(){h.width=window.innerWidth;h.height=window.innerHeight;h.aspect=h.width/h.height;h.diagonal=Math.hypot(h.width,h.height);h.w2=h.width/2;h.h2=h.height/2;c.style.width=h.width+
"px";c.style.height=h.height+"px";c.width=h.width;c.height=h.height;SCN.resize(h);IFC.Hud.resize(h)},click:function(a){},contextmenu:function(a){IFC.Tools.eat(a)},dblclick:function(a){},mousedown:function(a){p.device=q;q.down=!0;q.button=a.button;2===q.button&&p.overGlobe&&ANI.insert(0,ANI.library.cam2vector(p.intersect,2))},mouseup:function(){p.device=q;q.down=!1;q.button=NaN},mousemove:function(a){p.device=q;q.px=a.clientX;q.py=a.clientY;q.x=a.clientX/h.width*2-1;q.y=2*-(a.clientY/h.height)+1},
mouseenter:function(){p.device=q;p.overScreen=!0;SCN.setComb(1)},mouseleave:function(){p.overScreen=!1;SCN.setComb(4)},keydown:function(b){var c={" ":function(){return SCN.toggleRender()},g:function(){return a.toggleGUI()},m:function(){return IFC.Hud.toggleMenu()},t:function(){return SIM.setSimTime(-1,"hours")},z:function(){return SIM.setSimTime(1,"hours")}};if(c[b.key])return c[b.key](),IFC.Tools.eat(b)},touchstart:function(a){console.log("touchstart");n.down=0<a.touches.length;n.px=a.touches[0].pageX;
n.py=a.touches[0].pageY;n.x=n.px/h.width*2-1;n.y=2*-(n.py/h.height)+1;p.device=n},touchmove:function(){p.device=n},touchend:function(a){p.device=n;n.down=0===a.touches.length},touchcancel:function(a){p.device=n;n.down=0===a.touches.length},devicemotion:function(a){},deviceorientation:function(a){},orientationchange:function(a){console.log("orientationchange",a)}},toggleSpaceTime:function(){m=a.modus="space"===m?"time":"space";IFC.Hud.spacetime.updateModus()},updateGlobe:function(){SCN.camera.position.length()},
updatePointer:function(){var b,c=!1,d=p.overGlobe;l.splice(0,l.length);r.setFromCamera(p.device,SCN.camera);SCN.objects.pointer.raycast(r,l);(b=0<l.length?l[0]:null)?(p.intersect.copy(b.point).normalize(),c=!0):p.intersect.set(0,0,0);c&&!d&&a.events.onglobeenter();!c&&d&&a.events.onglobeleave();p.overGlobe=c},updateLatLon:function(){var a=p.intersect;a.x||a.y||a.z?(p.latitude=90-180*Math.acos(a.y)/PI,p.longitude=(270+180*Math.atan2(a.x,a.z)/PI)%360):(p.latitude=NaN,p.longitude=NaN)}}}();"use strict";
IFC.initGUI=function(){var a=new dat.GUI({closeOnTop:!0}),b={},c={};a.closed=!0;H.each(CFG.Preset,function(d,e){var f={},g;e.isFolder?(delete e.isFolder,H.each(e,function(a,b){"isFolder"!==a&&(f[a]=b.val?b.val:b)}),b[d]=a.addFolder(d),c[d]={},H.each(e,function(a,e){g=SCN.actions.bind(null,d,a);e.val&&e.choose?c[d][a]=b[d].add(f,a,e.choose).onChange(g):e.val?c[d][a]=e.step?b[d].add(f,a,e.min,e.max).step(e.step).onChange(g):b[d].add(f,a,e.min,e.max).onChange(g):H.endsWith(a,"color")?c[d][a]=b[d].addColor(f,
a,e).onChange(g):c[d][a]="function"===typeof e?b[d].add(f,a).onChange(g):b[d].add(f,a,e).onChange(g)})):(f[d]=e,c[d]="function"===typeof e?a.add(f,d).onChange(e):"string"===typeof e?a.add(f,d,e).onChange(function(a){SCN.actions(d,"update",a)}):a.add(f,d,e).onChange(function(a){SCN.actions(d,"toggle",a)}))});window.GUIcontrollers=c;window.GUI=a};
IFC.Tools={eat:function(a){if(a)return a.preventDefault(),a.stopPropagation(),!1},formatLatLon:function(a,b){b.lat=0>b.lat?"S "+Math.abs(b.lat).toFixed(0):"N "+Math.abs(b.lat).toFixed(0);b.lon=0>b.lon?"E "+Math.abs(b.lon).toFixed(0):"W "+Math.abs(b.lon).toFixed(0);return"<strong>"+a+"</strong> "+b.lat+", "+b.lon},updateUrl:TOOLS.debounce(function(){if(CFG.isLoaded){var a=SIM.time.model.format("YYYY-MM-DD-HH-mm"),b=SCN.scene.children.filter(function(a){return a.visible&&"camera"!==a.name}).map(function(a){return CFG.Objects[a.name].id}).filter(function(a){return!!a});
b=CFG.Manager.assets2hash(b)||0;var c=SCN.camera.position;c=H.round(c.x,6)+";"+H.round(c.y,6)+";"+H.round(c.z,6);History.replaceState({},CFG.Title,"/"+b+"/"+a+"/"+c)}},120),takeScreenShot:function(){var a=this.getFrame("image/png"),b="menubar=no,scrollbars=no,location=no,status=no,resizable=yes,innerHeight="+a.height/2+",innerWidth="+a.width/2;a=window.open(a.url,"screenshot",b);a.focus();console.log("win.open",a,b)},getFrame:function(a){var b=SCN.renderer.domElement;return{width:b.width,height:b.height,
url:b.toDataURL(a),num:SCN.frames}},raycast:function(a,b){var c=c.setFromCamera(a.device,SCN.camera);a=this.geometry;var d=this.material,e=this.matrixWorld;if(void 0!==d&&(null===a.boundingSphere&&a.computeBoundingSphere(),sphere.copy(a.boundingSphere),sphere.applyMatrix4(e),!1!==c.ray.intersectsSphere(sphere)&&(inverseMatrix.getInverse(e),ray.copy(c.ray).applyMatrix4(inverseMatrix),null===a.boundingBox||!1!==ray.intersectsBox(a.boundingBox)))){var f;if(a.isBufferGeometry){var g=a.index;d=a.attributes.position;
e=a.attributes.uv;var k;if(null!==g){var l=0;for(k=g.count;l<k;l+=3){a=g.getX(l);var m=g.getX(l+1);var h=g.getX(l+2);if(f=checkBufferGeometryIntersection(this,c,ray,d,e,a,m,h))f.faceIndex=Math.floor(l/3),b.push(f)}}else for(l=0,k=d.count;l<k;l+=3)if(a=l,m=l+1,h=l+2,f=checkBufferGeometryIntersection(this,c,ray,d,e,a,m,h))f.index=a,b.push(f)}else if(a.isGeometry){e=Array.isArray(d);l=a.vertices;k=a.faces;m=a.faceVertexUvs[0];0<m.length&&(g=m);for(var q=0,n=k.length;q<n;q++){var p=k[q];f=e?d[p.materialIndex]:
d;if(void 0!==f){m=l[p.a];h=l[p.b];var r=l[p.c];if(!0===f.morphTargets){f=a.morphTargets;var u=this.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var v=0,B=f.length;v<B;v++){var w=u[v];if(0!==w){var y=f[v].vertices;vA.addScaledVector(tempA.subVectors(y[p.a],m),w);vB.addScaledVector(tempB.subVectors(y[p.b],h),w);vC.addScaledVector(tempC.subVectors(y[p.c],r),w)}}vA.add(m);vB.add(h);vC.add(r);m=vA;h=vB;r=vC}if(f=checkIntersection(this,c,ray,m,h,r,intersectionPoint))g&&g[q]&&(u=
g[q],uvA.copy(u[0]),uvB.copy(u[1]),uvC.copy(u[2]),f.uv=uvIntersection(intersectionPoint,m,h,r,uvA,uvB,uvC)),f.face=p,f.faceIndex=q,b.push(f)}}}}}};
IFC.Hud=function(){var a,b=!0,c=document.querySelectorAll.bind(document)(".simulator")[0],d=new THREE.OrthographicCamera(0,0,100,100,1,10),e=new THREE.Scene,f=new THREE.Object3D,g={},k=null,l=null,m=0,h=0,q=0,n=0,p=!1,r=NaN;return a={menu:f,sprites:g,init:function(){var b=IFC.geometry;d.position.z=10;r=(b.width+64)/b.width*3;f.scale.set(r,r,1);a.initSprites();e.add(f);e.add(d);a.resize(b)},render:function(a){b&&a.render(e,d)},resize:function(b){d.left=-b.w2;d.right=b.w2;d.top=b.h2;d.bottom=-b.h2;
d.updateProjectionMatrix();r=(b.width+64)/b.width*3;a.posSprites()},initSprites:function(){var a=IFC.geometry;H.each(CFG.Sprites,function(b,c){var d=IFC.Hud[b],h=new THREE.Sprite(new THREE.SpriteMaterial({opacity:c.material.opacity,transparent:!0}));!1!==c.visible&&(h.cfg=c,h.name=b,g[b]=h,c.menu?f.add(h):e.add(h),c.material.image&&(h.material.map=CFG.Textures[c.material.image]),c.material.color&&(h.material.color=c.material.color),"100%"===c.position.width?h.scale.set(a.width,c.position.height,1):
h.scale.set(c.position.width,c.position.height,1),!1!==c.hover?(h.onmouseenter=h.touchstart=function(){ANI.insert(0,ANI.library.sprite.enter(h,200))},h.onmouseleave=h.touchend=function(){ANI.insert(0,ANI.library.sprite.leave(h,200))}):h.onmouseleave=h.onmouseenter=function(){},c.onclick&&(h.click=c.onclick.bind(h,h)),d&&(d.init(h,c),h.widget=d))})},posSprites:function(){var a,b=IFC.geometry.width,c=b/2,d=IFC.geometry.height/2;H.each(g,function(e,f){a=f.cfg.position;"100%"===a.width?(f.position.set(0,
d-a.top-a.height/2,a.zIndex),f.scale.setX(b)):a.bottom&&a.right?f.position.set(+c-a.right-a.width/2,-d+a.bottom+a.height/2,a.zIndex):a.bottom&&a.left?f.position.set(-c+a.left+a.width/2,-d+a.bottom+a.height/2,a.zIndex):a.right&&a.top?f.position.set(+c-a.right-a.width/2,d-a.top-a.height/2,a.zIndex):a.center&&"x"===a.center?f.position.set(0,d-a.top-a.height/2,a.zIndex):f.position.set(-c+a.left+a.width/2,d-a.top-a.height/2,a.zIndex)})},toggle:function(){b=!b},activate:function(){H.each([[c,"mousedown"],
[c,"mouseup"],[c,"mousemove"],[c,"touchstart"],[c,"touchmove"],[c,"touchend"],[c,"touchcancel"],[window,"orientationchange"]],function(b,c){return c[0].addEventListener(c[1],a.events[c[1]],!1)})},step:function(a,b){a%4||IFC.Hud.time.render();IFC.Hud.spacetime.render()},events:{mousedown:function(a){},mouseup:function(a){l&&l.click()},mousemove:function(b){(b=a.testHit(b.pageX,b.pageY))?(l&&b!==l&&(l.hit=!1,l.onmouseleave(),l=null),b.hit||(b.hit=!0,b.onmouseenter()),l=b):l&&(l.hit=!1,l.onmouseleave(),
l=null)},touchstart:function(b){if(1===b.changedTouches.length){var c=b.changedTouches[0].pageX;b=b.changedTouches[0].pageY;if(c=a.testHit(c,b))k=c}},touchend:function(b){var c;(c=a.testHit(b.changedTouches[0].pageX,b.changedTouches[0].pageY))&&c===k&&(c.click&&c.click(),IFC.Tools.eat(b));k=null},orientationchange:function(b){a.resize();console.log("HUD.orientationchange")}},toggleMenu:function(){(p=!p)&&f.scale.set(.01,.01,1);ANI.insert(0,ANI.library.menu.scale(p?1:r,400))},testHit:function(a,b){var c,
d,e,f=!1,k=null,l=IFC.Hud.menu.position.x,r=IFC.Hud.menu.position.y,u=IFC.geometry,v=u.width,E=u.height,F=u.w2;H.each(g,function(g,u){c=u.cfg.position;d=u.cfg.menu;e=!(d&&!p);!k&&e&&u.cfg.onclick&&(void 0!==c.bottom&&void 0!==c.left?(m=d?l+c.left:c.left,n=d?r+E-c.bottom:E-c.bottom,h=n-c.height,q=m+c.width):void 0!==c.right&&void 0!==c.bottom?(q=d?l+v-c.right:v-c.right,n=d?r+E-c.bottom:E-c.bottom,h=n-c.height,m=q-c.width):void 0!==c.right&&void 0!==c.top?(q=d?l+v-c.right:v-c.right,h=d?r+c.top:c.top,
m=q-c.width,n=h+c.height):void 0!==c.left&&void 0!==c.top?(m=d?l+c.left:c.left,h=d?r+c.top:c.top,q=m+c.width,n=h+c.height):void 0!==c.center&&"x"===c.center?(h=c.top,m=F-c.width/2,n=h+c.height,q=m+c.width):void 0!==c.center&&"y"===c.center?console.log("IFC.testHit",u.name,"unhandled pos"):console.log("IFC.testHit",u.name,"strange pos"),k=(f=a>m&&b>h&&a<q&&b<n)?u:null)});return k}}}();
IFC.Hud.spacetime=function(){var a,b,c,d,e,f,g,k=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,0);return a={init:function(c,h){d=c;b=h;e=b.canvas;f=e.getContext("2d");e.width=64;e.height=64;g=new THREE.CanvasTexture(e);a.updateModus();a.render()},updateModus:function(a){c=void 0===a?IFC.modus:a;d.material.map="space"===c?CFG.Textures["hud/space.png"]:g;d.material.map.needsUpdate=!0},render:function(){"space"===c?a.renderSpace():a.renderTime()},renderSpace:function(){if(IFC.controller){var a=IFC.controller.info();
var b=a.veloX;a=a.veloY;if(b||a)l.setX(b),l.setY(-a),b=l.angleTo(k),d.material.rotation=b}},renderTime:function(){var a=e.width,b=a/2,c=e.height,g=c/2,k=SIM.time.model,l=k.seconds(),u=k.minutes();k=k.hours()%12;d.material.rotation=0;f.save();f.clearRect(0,0,a,c);f.translate(b,g);f.scale(.4,.4);f.rotate(-Math.PI/2);f.strokeStyle="white";f.lineCap="round";f.save();f.rotate(Math.PI/6*k+Math.PI/360*u+Math.PI/21600*l);f.lineWidth=14;f.beginPath();f.moveTo(-10,0);f.lineTo(40,0);f.stroke();f.restore();f.save();
f.rotate(Math.PI/30*u+Math.PI/1800*l);f.lineWidth=10;f.beginPath();f.moveTo(-16,0);f.lineTo(56,0);f.stroke();f.restore();f.beginPath();f.lineWidth=12;f.strokeStyle="#ddd";f.arc(0,0,72,0,2*Math.PI,!0);f.stroke();f.restore()}}}();
IFC.Hud.time=function(){var a,b,c,d,e,f;return a={init:function(g,k){b=g;c=k;d=c.canvas;e=d.getContext("2d");d.width=c.position.width;d.height=c.position.height;e.font="24px monospace";e.fillStyle="#eee";e.textBaseline="bottom";f=new THREE.CanvasTexture(d);b.material.map=f;a.render()},render:function(){var a=SIM.time.fmtDay,b=SIM.time.fmtHour,c=SIM.time.doe.toFixed(2);if(e){e.clearRect(0,0,d.width,d.height);e.fillStyle="#ddd";e.font="bold 22px monospace";var m=e.measureText(a);e.fillText(a,(d.width-
m.width)/2,34);e.font="bold 16px monospace";m=e.measureText(b);e.fillText(b,(d.width-m.width)/2,54);e.font="bold 11px monospace";e.measureText(c);f.needsUpdate=!0}}}}();
IFC.Hud.performance=function(){var a,b,c,d,e,f,g,k,l=NaN,m=NaN,h=NaN,q=H.createRingBuffer(60),n=H.createRingBuffer(60),p={0:"#666",1:"#fff",2:"#666"},r=2,u={1:"Debug",2:"Scene",3:"Bandwidth"};return a={selectModus:function(a){if("string"===typeof a){debugger;r=u[a]}else r="number"===typeof a?a:3<r+1?1:r+1},init:function(a,h){b=a;c=h;d=c.canvas;e=d.getContext("2d");f=c.back;k=f.getContext("2d");d.width=f.width=c.position.width;d.height=f.height=c.position.height;g=b.material.map=new THREE.CanvasTexture(d)},
render:function(){e.clearRect(0,0,d.width,d.height);a["render"+u[r]]();g.needsUpdate=!0},renderDebug:function(){IFC.controller.status()},renderBandwidth:function(){e.font="11px monospace";e.fillStyle="#ddd";e.fillText("bandwidth",4,d.height/2)},renderScene:function(){var a=H.scale(h,0,60,0,18);k.globalCompositeOperation="source-over";k.fillStyle=50<h?"#008800":"#ee0000";k.fillRect(f.width-1,47,1,-a);k.globalCompositeOperation="copy";k.drawImage(f,1,0,f.width-1,f.height,0,0,f.width-1,f.height);e.drawImage(f,
0,0);for(a=0;3>a;a++)e.fillStyle=p[a],e.fillRect(0,d.height/4.5*(a+1),d.width,1.1);e.font="11px monospace";e.fillStyle="#ddd";e.fillText(q.avg().toFixed(1)+"d",100,62);e.fillText(n.avg().toFixed(1)+"fps",0,62)},begin:function(){l=window.performance.now();h=m?1E3/(l-m):60;n.push(h);m=l},end:function(){q.push(window.performance.now()-l)}}}();"use strict";
IFC.Controller=function(){function a(a){if(a)return a.preventDefault(),a.stopPropagation(),!1}function b(a,b,c){return(c-b)*(a-n.minDistance)/(n.maxDistance-n.minDistance)+b}var c=Math.PI,d=2*c,e=Math.max,f=Math.min,g=Math.abs,k=Math.hypot,l,m,h,q,n={},p=new THREE.Spherical,r=!1,u=0,v=H.createAttenuator(10),B=H.createAttenuator(10),w=0,y=0,A=0,I=NaN,C=NaN,J=NaN,D="",K=NaN,E=NaN,F=NaN,O=NaN,N=NaN,P=NaN,Q=NaN,L=NaN,M=NaN,R=NaN,S=NaN,T=!1,U=!1,G={},V={minDistance:1.2,maxDistance:8,onwheel:null,ondrag:null,
onorient:null,onkey:function(){},onRelax:function(){},onAwake:function(){},keys:"tzuiop".split(""),lookAt:new THREE.Vector3(0,0,0),dampX:.94,dampY:.94,dampZ:.9,keyXimpulse:.05,keyYimpulse:.05,keyZimpulse:.5,wheelYimpulse:.5,wheelXimpulse:.5,moveXimpulse:.004,moveYimpulse:.004,keyInterval:100,keyactions:{y:function(){return l.stop()},x:function(){return l.reset()},a:function(a){return l.impulse(-a,0,0)},d:function(a){return l.impulse(a,0,0)},w:function(a,b){return l.impulse(0,-b,0)},s:function(a,b){return l.impulse(0,
b,0)},e:function(a,b,c){return l.impulse(0,0,c)},q:function(a,b,c){return l.impulse(0,0,-c)}}};return l={spherical:p,status:function(){G.alpha=I;G.beta=C;G.gamma=J;G.veloX=w;G.veloY=y;G.veloZ=A;G.attOrientX=v();G.attOrientY=B();return G},init:function(a,b,c){m=a;h=m.position.clone();q=[[b,"mousedown"],[b,"mouseup"],[b,"mousemove"],[b,"mouseleave"],[b,"wheel"],[b,"touchstart"],[b,"touchmove"],[b,"touchend"],[b,"touchcancel"],[document,"keydown"],[document,"keyup"],[window,"deviceorientation"]];p.setFromVector3(m.position);
Object.assign(n,V,c)},activate:function(){r=!0;H.each(q,function(a,b){return b[0].addEventListener(b[1],l.events[b[1]],!1)})},deactivate:function(){r=!1;H.each(q,function(a,b){return b[0].removeEventListener(b[1],l.events[b[1]],!1)})},info:function(){return{veloX:w,veloY:y,veloZ:A}},reset:function(){l.stop();m.position.copy(h)},stop:function(){A=y=w=0},impulse:function(a,b,c){w+=a;y+=b;A+=c},step:function(a,b){a=m.radius;if(r){u+=1;w=1E-6<g(w)?w*n.dampX:0;y=1E-6<g(y)?y*n.dampY:0;A=1E-6<g(A)?A*n.dampZ:
0;(T=w||y||A)&&!U&&n.onAwake();!T&&U&&n.onRelax();U=T;if(w||y)p.radius=a,p.theta+=w*b,p.phi+=y*b,p.theta=p.theta>d?p.theta-d:p.theta,p.phi=e(1E-6,p.phi),p.phi=f(c-1E-6,p.phi),m.position.setFromSpherical(p),m.phi=p.phi,m.theta=p.theta,m.radius=p.radius;A&&(a*=1+A*b/a,a=a<n.minDistance?n.minDistance:a>n.maxDistance?n.maxDistance:a,m.position.setLength(a));m.lookAt(n.lookAt)}},events:{deviceorientation:function(a){u%10||v(a.gamma);u%10||B(a.beta);var b=a.gamma-v(),c=a.beta-B();I=a.alpha;C=a.beta;J=a.gamma;
if(.1<g(b)||.1<g(b))if(b=.2*(b- -20)/40+-.1,c=.2*(c- -20)/40+-.1,n.onorient)n.onorient(l.impulse,b,c,0);else l.impulse(b,c,0)},mouseleave:function(a){l.events.mouseup(a)},mousedown:function(a){E=K=a.pageX;F=a.pageY},mouseup:function(a){F=E=K=NaN},mousemove:function(c){var d=m.position.length();var e=b(d,1,n.maxDistance-n.minDistance);if(!isNaN(K)){d=(E-c.pageX)*n.moveXimpulse*e;e*=(F-c.pageY)*n.moveYimpulse;if(n.ondrag)n.ondrag(l.impulse,d,e,0);else l.impulse(d,e,0);E=c.pageX;F=c.pageY;return a(c)}},
wheel:function(c){var d=m.position.length();var e=b(d,.2,n.maxDistance-n.minDistance);switch(c.deltaMode){case 2:debugger;d=.025*c.deltaX;e=.025*c.deltaY;break;case 1:d=.2*c.deltaX;e*=.4*c.deltaY;break;default:d=.01*c.deltaX,e*=.02*c.deltaY}if(n.onwheel)n.onwheel(l.impulse,d,0,e);else l.impulse(d,0,e);return a(c)},touchcancel:function(a){l.stop()},touchend:function(a){M=L=N=O=NaN},touchstart:function(a){switch(a.touches.length){case 1:O=a.touches[0].pageX;N=a.touches[0].pageY;P=O;Q=N;break;case 2:L=
a.touches[0].pageX-a.touches[1].pageX,M=a.touches[0].pageY-a.touches[1].pageY,R=L,S=M}},touchmove:function(c){var d=m.position.length();var e=b(d,1,n.maxDistance-n.minDistance);if(1===c.changedTouches.length){d=(P-c.changedTouches[0].pageX)*n.moveXimpulse*e;e*=(Q-c.changedTouches[0].pageY)*n.moveYimpulse;if(n.ondrag)n.ondrag(l.impulse,d,e,0);else l.impulse(d,e,0);P=c.changedTouches[0].pageX;Q=c.changedTouches[0].pageY;return a(c)}if(2===c.changedTouches.length)return L=c.changedTouches[0].pageX-c.changedTouches[1].pageX,
M=c.changedTouches[0].pageY-c.changedTouches[1].pageY,d=k(L,M)-k(R,S),l.impulse(0,0,-d*e*.01),R=L,S=M,a(c)},keydown:function(c){var d=m.position.length(),e=b(d,1,n.maxDistance-n.minDistance);d=n.keyXimpulse*e;var f=n.keyYimpulse*e;e*=n.keyZimpulse;D=c?c.key:D;if(n.keyactions[D])return n.keyactions[D](d,f,e),a(c);if(-1!==n.keys.indexOf(D))return n.onkey(D),a(c)},keyup:function(a){D=""}}}}();
var LDR=function(){var a,b=[],c=$(".progress .header"),d=$(".progress .info"),e=$(".progress .bar"),f=$(".progress .meter");return a={sequence:function(){return[[TIM.step,["LDR.sequence","started"]],[CFG.Preset.init],[IFC.initGUI],[CFG.Manager.probeDevice],[CFG.Manager.probeFullscreen],[CFG.Manager.lockOrientation,["portrait-primary"]],[SCN.probeDevice],"lift off!",[RES.init],[ANI.init],[SIM.init],[SCN.init],[SIM.setSimTime],"stage 1",a.loadImages,"stage 2",a.loadAssets,"stage 3",a.loadObservations,
"reaching orbit",[IFC.init],[SIM.updateSun],"uploading to GPU",[SCN.prerender,null,"may take a while ..."],"recalibrating",[SCN.render],"get ready",[IFC.activate],[IFC.show],[a.clearInfo],[navigator.vibrate.bind(navigator),[200]],"have fun"]},clearInfo:function(){d.text("");e.text("");f.css({width:"0.1%"})},message:function(a,b){a&&c.text(a);b&&d.text(b)},parse:function(c){H.each(c,function(c,d){if("string"===typeof d)b.push(function(b){a.message(d,"");b()});else if("function"===typeof d)c=d(),a.parse(c);
else if(Array.isArray(d)){var e=d[0];var f=d[1]||[];var g=d[2]||"processing";b.push(function(b){a.message("",g);b()});b.push(function(a){"callback"===f?e.apply(null,[a]):(e.apply(null,f),a())})}else{debugger;console.log("WTF")}})},execute:function(a){var c=Date.now(),d=b.map(function(a,b){return function(c){e.text(b+1+"/"+d.length);f.css({width:~~((b+1)/d.length*100)+"%"});setTimeout(function(){return a(c)},1)}});async.series(d,function(b){if(b)throw b;TIM.step("LDR.executed",d.length,"tasks",((Date.now()-
c)/1E3).toFixed(1),"secs");a()})},loadImages:function(){function b(a){H.each(CFG.Textures,function(b,c){c===a.url&&(CFG.Textures[b]=a.data)})}return Object.keys(CFG.Textures).map(function(a){return CFG.Textures[a]}).map(function(c){return[function(d){a.message(null,c.split("/").slice(-1)[0]);RES.load({type:"texture",urls:[c],onFinish:function(a,c){c.forEach(b);d()}})},"callback"]})},loadAssets:function(){var b=[];H.each(CFG.Objects,function(c,d){if("simulation"!==d.type)if(d.name=c,d.visible){var e=
function(b){a.message("",c);setTimeout(function(){SCN.Tools.loader[d.type](c,d,b)},1)};b.push([e,"callback"])}else SCN.objects[c]=d});return b},loadObservations:function(){var b=[[function(){RES.onload=function(a){d.text(a.split("/").slice(-1)[0])}}]];H.each(CFG.Objects,function(c,d){if("simulation"===d.type)if(d.name=c,d.visible){var e=function(b){a.message("",d.title);setTimeout(function(){SCN.Tools.loader[d.type](c,d,b)},1)};b.push([e,"callback"])}else SCN.objects[c]=d});b.push([function(){RES.onload=
null}]);return b}}}();
